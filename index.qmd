---
title: åŸºäº PostgreSQL çš„å°å‹åŸºå› è¡¨è¾¾é‡æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ
authors:
  - name: You know who i am ,motherfucker
    affiliation: The University of myself
    roles: coding
    corresponding: true
bibliography: references.bib
---

## åŸºç¡€è®¾æ–½æ­å»º (Infrastructure)

***ä¸‹è½½éœ€è¦çš„toolsè¿˜æœ‰è½¯ä»¶***

**â‘  æ›´æ–°è½¯ä»¶åˆ—è¡¨**\
å…¬å¸æœåŠ¡å™¨å¯èƒ½å¾ˆä¹…æ²¡æ›´æ–°äº†ï¼Œå…ˆå‘Šè¯‰å®ƒæœ€æ–°çš„è½¯ä»¶åœ¨å“ªä¹°ã€‚

``` bash
sudo apt update
```

**â‘¡ å®‰è£… PostgreSQL åŠå…¶æ ¸å¿ƒç»„ä»¶**\
è¿™è¡Œå‘½ä»¤ä¼šæŠŠæ•°æ®åº“ä¸»ç¨‹åºå’Œä¸€äº›å¸¸ç”¨çš„æ‰©å±•å·¥å…·åŒ…ä¸€èµ·è£…å¥½ã€‚

``` bash
sudo apt install postgresql postgresql-contrib
```

**â‘¢ å¯åŠ¨æœåŠ¡å¹¶è®¾ç½®å¼€æœºè‡ªå¯ï¼ˆå…³é”®ç‚¹ï¼‰**\
åœ¨ä¸ªäººç”µè„‘ä¸Šå¯èƒ½æ— æ‰€è°“ï¼Œä½†åœ¨å…¬å¸é‡Œï¼ŒæœåŠ¡å™¨å¶å°”ä¼šé‡å¯ã€‚**å¦‚æœä¸è®¾å¼€æœºè‡ªå¯ï¼ŒæœåŠ¡å™¨ä¸€é‡å¯æ•°æ®åº“å°±æŒ‚äº†ï¼ŒåŠå¤œæŠ¥è­¦ä½ å¾—çˆ¬èµ·æ¥ä¿®ã€‚**

``` bash
# å¯åŠ¨æ•°æ®åº“æœåŠ¡ 
sudo systemctl start postgresql 
# è®¾ç½®å¼€æœºè‡ªåŠ¨å¯åŠ¨ï¼ˆä¼ä¸šçº§è§„èŒƒï¼‰ 
sudo systemctl enable postgresql
```

**â‘£ æ£€æŸ¥æ˜¯å¦æˆåŠŸ**\
è¿™æ˜¯ä¸“ä¸šäººå£«çš„ä¹ æƒ¯ï¼šåšå®Œä¸€å®šè¦æ£€æŸ¥ã€‚

``` bash
sudo systemctl status postgresql
```

**çœ‹åˆ°ä»€ä¹ˆç®—æˆåŠŸï¼Ÿ**\
å¦‚æœä½ çœ‹åˆ°å±å¹•ä¸Šäº®ç€ç»¿ç¯ï¼Œå†™ç€Â Active: active (exited)Â æˆ–è€…Â Active: runningï¼Œæ­å–œï¼Œæ¡£æ¡ˆæŸœç»„è£…å®Œæˆäº†

``` bash
(base) jayz@WIN-92H1MBQ8SBB:/mnt/d/acode/datasql/script$ sudo systemctl start postgresql 
(base) jayz@WIN-92H1MBQ8SBB:/mnt/d/acode/datasql/script$ sudo systemctl status postgresql
â— postgresql.service - PostgreSQL RDBMS
     Loaded: loaded (/usr/lib/systemd/system/postgresql.service; enabled; preset: enabled)     
     Active: active (exited) since Fri 2025-12-05 17:09:15 CST; 40s ago
   Main PID: 2910 (code=exited, status=0/SUCCESS)

Dec 05 17:09:15 WIN-92H1MBQ8SBB systemd[1]: Starting postgresql.service - PostgreSQL RDBMS...  
Dec 05 17:09:15 WIN-92H1MBQ8SBB systemd[1]: Finished postgresql.service - PostgreSQL RDBMS.
```

------------------------------------------------------------------------

## æƒé™éš”ç¦» â€”â€” åˆ›å»ºâ€œç”Ÿä¿¡é¡¹ç›®â€ä¸“å±ç¯å¢ƒ

#### 1. è¿™æ­¥æ˜¯åœ¨å¹²å˜›ï¼Ÿï¼ˆå…¬å¸è§†è§’ï¼‰

PostgreSQL è£…å¥½åï¼Œé»˜è®¤é€äº†ä¸€ä¸ªè¶…çº§ç®¡ç†å‘˜è´¦å·å« `postgres`ï¼ˆè¿™å°±å¥½æ¯”æ•´ä¸ªå¤§æ¥¼çš„æ€»ç®¡ï¼Œæˆ–è€…è¯´â€œç‰çš‡å¤§å¸â€ï¼‰ã€‚

âŒ **å°ç™½é”™è¯¯**ï¼šç›´æ¥ç”¨ *`postgres`* è¶…çº§è´¦å·å»è¿ Python ä»£ç ã€‚\
âœ… **å…¬å¸è§„èŒƒ**ï¼š**æƒé™éš”ç¦»**ã€‚\
ä½ éœ€è¦æ‹›è˜ä¸€ä¸ªâ€œå›¾ä¹¦ç®¡ç†å‘˜â€ï¼ˆåˆ›å»ºæ–°ç”¨æˆ·ï¼‰ï¼Œä¸“é—¨è´Ÿè´£ç®¡ç†ç”Ÿç‰©ä¿¡æ¯é‚£ä¸€éƒ¨åˆ†çš„æ•°æ®ã€‚\
è¿™æ ·ä¸‡ä¸€è¿™ä¸ªç”¨æˆ·å¯†ç æ³„éœ²äº†ï¼Œé»‘å®¢ä¹Ÿåªèƒ½åŠ¨ç”Ÿç‰©æ•°æ®ï¼ŒåŠ¨ä¸äº†å…¬å¸çš„è´¢åŠ¡æ•°æ®ã€‚è¿™å«**æœ€å°æƒé™åŸåˆ™**ã€‚

æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„ç”Ÿç‰©ç®¡ç†å‘˜ï¼š*`bio_admin`*ã€‚\
åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„ç”Ÿç‰©æ•°æ®åº“ï¼š*`omics_db`*ï¼ˆomics = ç»„å­¦ï¼‰ã€‚

**â‘  åˆ‡æ¢åˆ°è¶…çº§ç®¡ç†å‘˜èº«ä»½**\
å…ˆå˜æˆâ€œç‰çš‡å¤§å¸â€æ‰èƒ½åœ¨è¿™ä¸ªä¸–ç•Œé€ äººã€‚

**codeBash**

``` bash
sudo -u postgres psql
```

**ç°è±¡**ï¼šä½ ä¼šå‘ç°å‘½ä»¤è¡Œå‰é¢çš„æ ·å­å˜äº†ï¼Œå˜æˆäº†Â postgres=#ï¼Œè¿™è¯´æ˜ä½ å·²ç»è¿›åˆ°äº†æ•°æ®åº“çš„æ§åˆ¶å°å†…éƒ¨ã€‚

**â‘¡ åˆ›å»ºé¡¹ç›®ä¸“ç”¨ç”¨æˆ·ï¼ˆUserï¼‰**\
æ³¨æ„ï¼šå‘½ä»¤åé¢ä¸€å®šè¦æœ‰**åˆ†å·** ;ï¼Œè¿™æ˜¯ SQL çš„è¯­æ³•ï¼Œä¸åŠ åˆ†å·å®ƒä»¥ä¸ºä½ æ²¡è¯´å®Œã€‚

``` sql
CREATE USER bio_admin WITH PASSWORD 'bio12345';
```

``` bash
(base) jayz@WIN-92H1MBQ8SBB:/mnt/d/acode/datasql/script$ sudo -u postgres psql
psql (16.11 (Ubuntu 16.11-0ubuntu0.24.04.1))
Type "help" for help.

postgres=# 
postgres=# CREATE USER bio_admin WITH PASSWORD 'bio12345';
CREATE ROLE
```

**è§£é‡Š**ï¼šä½ åˆ›å»ºäº†ä¸€ä¸ªäººå«Â `bio_admin`ï¼Œä»–çš„è¿›é—¨å¯†ç æ˜¯Â bio12345ã€‚

**â‘¢ åˆ›å»ºé¡¹ç›®ä¸“ç”¨æ•°æ®åº“ï¼ˆDatabaseï¼‰**

``` sql
CREATE DATABASE omics_db OWNER bio_admin;
```

**è§£é‡Š**ï¼šä½ å»ºäº†ä¸€ä¸ªå«Â `omics_db`Â çš„ä»“åº“ï¼Œå¹¶ä¸”æŒ‡åé“å§“è¯´ï¼šè¿™ä¸ªä»“åº“çš„ä¸»äººï¼ˆOWNERï¼‰æ˜¯åˆšæ‰é‚£ä¸ªÂ `bio_admin`ã€‚

``` sql
postgres=# CREATE DATABASE omics_db OWNER bio_admin;
CREATE DATABASE
```

**â‘£ èµ‹äºˆæƒé™ï¼ˆä¿é™©èµ·è§ï¼‰**\
è™½ç„¶æŒ‡å®šäº† Ownerï¼Œä½†æœ‰æ—¶å€™æƒé™ä¸å…¨ï¼Œæˆ‘ä»¬å†ç¡®è®¤ä¸€ä¸‹ä»–æ‹¥æœ‰è¿™ä¸ªæ•°æ®åº“çš„æ‰€æœ‰æƒã€‚

**codeSQL**

``` sql
GRANT ALL PRIVILEGES ON DATABASE omics_db TO bio_admin;
```

``` sql
postgres=# GRANT ALL PRIVILEGES ON DATABASE omics_db TO bio_admin;

GRANT
```

**â‘¤ é€€å‡ºè¶…çº§ç®¡ç†å‘˜æ¨¡å¼**\
å¹²å®Œæ´»äº†ï¼Œèµ¶ç´§é€€å‡ºï¼Œä¸è¦ä¸€ç›´å¾…åœ¨è¶…çº§æƒé™é‡Œï¼Œå®¹æ˜“æ‰‹æ»‘åˆ åº“ã€‚

``` sql
\q
```

``` bash
postgres=# \q
(base) jayz@WIN-92H1MBQ8SBB:/mnt/d/acode/datasql/script$ 
```

**æ³¨æ„**ï¼šæ˜¯åæ–œæ Â \\Â åŠ ä¸Šå­—æ¯Â qÂ (quit)ã€‚

------------------------------------------------------------------------

### ğŸ§ª éªŒè¯æ—¶åˆ»ï¼šä½ çš„æ“ä½œæˆåŠŸäº†å—ï¼Ÿ

å…‰åšå®Œä¸è¡Œï¼Œæˆ‘ä»¬ç°åœ¨è¦**æ¨¡æ‹Ÿä¸šåŠ¡æ–¹**ç™»å½•ä¸€ä¸‹ï¼Œçœ‹èƒ½ä¸èƒ½è¿›å¾—å»ã€‚

åœ¨ç»ˆç«¯é‡Œï¼ˆé€€å‡ºåˆ°æ­£å¸¸çš„ ubuntu å‘½ä»¤è¡Œåï¼‰ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤å°è¯•ç”¨**æ–°ç”¨æˆ·**ç™»å½•**æ–°åº“**ï¼š

``` bash
psql -h localhost -U bio_admin -d omics_db
```

``` sql
(base) jayz@WIN-92H1MBQ8SBB:/mnt/d/acode/datasql/script$ psql -h localhost -U bio_admin -d omics_db
Password for user bio_admin: 
psql (16.11 (Ubuntu 16.11-0ubuntu0.24.04.1))
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, compression: off)
Type "help" for help.

omics_db=>
```

***`omics_db=>`***,è¿™æ„å‘³ç€å·²ç»ä»é›¶æ­å»ºå¥½äº†ä¸€ä¸ªç¬¦åˆ**å®‰å…¨è§„èŒƒ**ã€**ä¸šåŠ¡éš”ç¦»**çš„å…¬å¸çº§æ•°æ®åº“åº•åº§ã€‚

------------------------------------------------------------------------

## æ•°æ®åº“å»ºæ¨¡ (Schema Design) â€”â€” æ‰®æ¼”â€œæ¶æ„å¸ˆâ€

DBA æˆ–æ¶æ„å¸ˆä¼šè¯´ï¼šâ€œæˆ‘ä»¬éœ€è¦ä¸¤å¼ è¡¨ã€‚ä¸€å¼ å­˜åŸºå› çš„åŸºæœ¬ä¿¡æ¯ï¼ˆå¦‚ TP53 æ˜¯å¹²å˜›çš„ï¼‰ï¼Œå¦ä¸€å¼ å­˜å…·ä½“çš„æµ‹åºè¡¨è¾¾é‡æ•°æ®ã€‚â€

åœ¨é¢è¯•é‡Œï¼Œè¿™é‡Œæœ‰ä¸€ä¸ª**å·¨å¤§çš„åŠ åˆ†é¡¹**ï¼š**å¤–é”®çº¦æŸï¼ˆForeign Keyï¼‰**ã€‚\
ä½ å¿…é¡»ä¿è¯ï¼š**åªæœ‰åœ¨åŸºå› è¡¨é‡Œå­˜åœ¨çš„åŸºå› ï¼Œæ‰èƒ½å½•å…¥è¡¨è¾¾é‡**ã€‚å¦‚æœæœ‰äººæƒ³å½•å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„åŸºå›  IDï¼Œæ•°æ®åº“ä¼šç›´æ¥æŠ¥é”™æ‹’ç»ã€‚è¿™å«**ç»´æŠ¤æ•°æ®çš„å®Œæ•´æ€§**ï¼Œæ˜¯éå¸¸ä¸“ä¸šçš„ä½“ç°ã€‚

#### 2. æ€ä¹ˆåšï¼Ÿï¼ˆå®æˆ˜æ“ä½œï¼‰

**â‘  ç™»å½•æ•°æ®åº“**\
è¿˜è®°å¾—åˆšåˆ›å»ºçš„è´¦å·å—ï¼Ÿç”¨å®ƒç™»å½•ï¼š

``` bash
psql -h localhost -U bio_admin -d omics_db
```

(è¾“å…¥å¯†ç Â bio12345)

**â‘¡ æ‰§è¡Œ SQL å»ºè¡¨è¯­å¥**\
è¯·ç›´æ¥å¤åˆ¶ä¸‹é¢çš„ SQL è¯­å¥åˆ°ç»ˆç«¯é‡Œæ‰§è¡Œã€‚æ¯ä¸€æ®µéƒ½è¦çœ‹åˆ° CREATE TABLE æˆ– CREATE INDEX çš„æˆåŠŸæç¤ºã€‚

**A. åˆ›å»ºåŸºå› è¡¨ (ä¸»è¡¨)**

``` sql
CREATE TABLE genes (
    gene_id VARCHAR(50) PRIMARY KEY,  -- Ensembl IDï¼Œä½œä¸ºä¸»é”®ï¼Œå”¯ä¸€çš„èº«ä»½è¯
    gene_symbol VARCHAR(50) NOT NULL, -- åŸºå› åï¼Œå¦‚ TP53
    chromosome VARCHAR(10),           -- æŸ“è‰²ä½“ä½ç½®
    description TEXT,                 -- åŸºå› åŠŸèƒ½æè¿°
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP -- è®°å½•å½•å…¥æ—¶é—´ï¼Œå®¡è®¡ç”¨
);
```

``` sql
(base) jayz@WIN-92H1MBQ8SBB:/mnt/d/acode/datasql/script$ psql -h localhost -U bio_admin -d omics_db
Password for user bio_admin: 
psql (16.11 (Ubuntu 16.11-0ubuntu0.24.04.1))
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, compression: off)
Type "help" for help.

omics_db=> CREATE TABLE genes (
    gene_id VARCHAR(50) PRIMARY KEY,  -- Ensembl IDï¼Œä½œä¸ºä¸»é”®ï¼Œå”¯ä¸€çš„èº«ä»½è¯
    gene_symbol VARCHAR(50) NOT NULL, -- åŸºå› åï¼Œå¦‚ TP53
    chromosome VARCHAR(10),           -- æŸ“è‰²ä½“ä½ç½®
    description TEXT,                 -- åŸºå› åŠŸèƒ½æè¿°
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP -- è®°å½•å½•å…¥æ—¶é—´ï¼Œå®¡è®¡ç”¨
);
CREATE TABLE
omics_db=>
```

**B. åˆ›å»ºè¡¨è¾¾é‡è¡¨ (ä»è¡¨ - å¸¦å¤–é”®)**\
æ³¨æ„çœ‹ REFERENCES genes(gene_id) è¿™ä¸€å¥ï¼Œè¿™å°±æ˜¯å¤–é”®ã€‚

``` sql
CREATE TABLE expression_data (
    id SERIAL PRIMARY KEY,            -- è‡ªå¢ IDï¼Œæ¯æ¡æ•°æ®ç‹¬ä¸€æ— äºŒ
    sample_id VARCHAR(50) NOT NULL,   -- æ ·æœ¬åç§°ï¼Œå¦‚ Sample_001
    gene_id VARCHAR(50) REFERENCES genes(gene_id), -- ã€å…³é”®ã€‘å…³è”åˆ°åŸºå› è¡¨
    tpm_value NUMERIC(10, 4),         -- è¡¨è¾¾é‡æ•°å€¼ï¼Œä¿ç•™4ä½å°æ•°
    sequencing_date DATE DEFAULT CURRENT_DATE
);
```

``` sql
omics_db=> CREATE TABLE expression_data (
    id SERIAL PRIMARY KEY,            -- è‡ªå¢ IDï¼Œæ¯æ¡æ•°æ®ç‹¬ä¸€æ— äºŒ
    sample_id VARCHAR(50) NOT NULL,   -- æ ·æœ¬åç§°ï¼Œå¦‚ Sample_001
    gene_id VARCHAR(50) REFERENCES genes(gene_id), -- ã€å…³é”®ã€‘å…³è”åˆ°åŸºå› è¡¨
    tpm_value NUMERIC(10, 4),         -- è¡¨è¾¾é‡æ•°å€¼ï¼Œä¿ç•™4ä½å°æ•°
    sequencing_date DATE DEFAULT CURRENT_DATE
);
CREATE TABLE
omics_db=>
```

**C. åˆ›å»ºç´¢å¼• (ä¸ºäº†æ€§èƒ½)**\
åŸºå› æ•°æ®é€šå¸¸æœ‰å‡ ä¸‡æ¡ï¼Œè¡¨è¾¾é‡æ•°æ®å¯èƒ½æœ‰å‡ ç™¾ä¸‡æ¡ã€‚ä¸ºäº†è®©ä»¥åæŸ¥è¯¢å¿«ä¸€ç‚¹ï¼Œæˆ‘ä»¬ç°åœ¨å°±å»ºç«‹â€œç›®å½•â€ï¼ˆIndexï¼‰ã€‚

``` sql
-- ä»¥åç»å¸¸é€šè¿‡åŸºå› åæœç´¢ï¼Œæ‰€ä»¥åŠ ä¸ªç´¢å¼•
CREATE INDEX idx_gene_symbol ON genes(gene_symbol);

-- ä»¥åç»å¸¸æŸ¥è¯¢æŸä¸ªæ ·æœ¬çš„æ‰€æœ‰åŸºå› ï¼Œæ‰€ä»¥åŠ ä¸ªç´¢å¼•
CREATE INDEX idx_sample_id ON expression_data(sample_id);
```

**â‘¢ æ£€æŸ¥æˆæœ**\
åœ¨ SQL ç•Œé¢è¾“å…¥ï¼š

``` sql
\dt
```

å¦‚æœçœ‹åˆ°Â genesÂ å’ŒÂ expression_dataÂ ä¸¤å¼ è¡¨å‡ºç°ï¼Œè¯´æ˜ Step 3 æˆåŠŸï¼\
(è¾“å…¥Â \\qÂ é€€å‡ºæ•°æ®åº“ï¼Œå›åˆ° Linux å‘½ä»¤è¡Œ)

``` sql
omics_db=> \dt
              List of relations
 Schema |      Name       | Type  |   Owner
--------+-----------------+-------+-----------
 public | expression_data | table | bio_admin
 public | genes           | table | bio_admin
(2 rows)

omics_db=>
```

### å¸¸è§æƒ…å†µ

-   **host**

    -   å¦‚æœä½ åœ¨æœ¬æœºå®‰è£…äº† PostgreSQL å¹¶ä¸”æ²¡æœ‰æ”¹é…ç½®ï¼Œé€šå¸¸å°±æ˜¯ `"localhost"`ã€‚

    -   å¦‚æœæ˜¯è¿œç¨‹æœåŠ¡å™¨ï¼Œå°±è¦å¡«æœåŠ¡å™¨çš„ IP åœ°å€æˆ–åŸŸåã€‚

-   **port**

    -   PostgreSQL é»˜è®¤ç«¯å£æ˜¯ **5432**ã€‚

    -   å¦‚æœä½ åœ¨å®‰è£…æˆ–å¯åŠ¨æ—¶ä¿®æ”¹è¿‡ç«¯å£ï¼Œéœ€è¦æŸ¥é…ç½®æ–‡ä»¶æˆ–å¯åŠ¨å‚æ•°

``` sql
omics_db=> \conninfo
You are connected to database "omics_db" as user "bio_admin" on host "localhost" (address "127.0.0.1") at port "5432".
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, compression: off)
omics_db=>
```

ç”¨ `pandas` + `psycopg2`çœ‹çœ‹data

```{python}
import psycopg2
import pandas as pd

conn = psycopg2.connect(
    dbname="omics_db",
    user="bio_admin",
    password="bio12345",
    host="localhost",   # æˆ–è€… "127.0.0.1"
    port="5432"
)

# ç¤ºä¾‹ï¼šæŸ¥çœ‹ genes è¡¨å‰ 5 è¡Œ
genes_df = pd.read_sql("SELECT * FROM genes LIMIT 5;", conn)
print(genes_df)

# ç¤ºä¾‹ï¼šæŸ¥çœ‹ expression_data è¡¨å‰ 5 è¡Œ
expr_df = pd.read_sql("SELECT * FROM expression_data LIMIT 5;", conn)
print(expr_df)

conn.close()

```

``` python
Empty DataFrame
Columns: [gene_id, gene_symbol, chromosome, description, created_at]
Index: []
Empty DataFrame
Columns: [id, sample_id, gene_id, tpm_value, sequencing_date]
Index: []
```

-   å»ºäº†è¡¨ (`genes` å’Œ `expression_data`)ï¼Œä½†è¿˜æ²¡ `INSERT` æ•°æ®è¿›å»ã€‚

-   æ‰€ä»¥ `SELECT * FROM genes LIMIT 5;` è¿”å› 0 è¡Œï¼Œè‡ªç„¶å°±æ˜¯ç©ºçš„ DataFrameã€‚

------------------------------------------------------------------------

## Python è¿æ¥æµ‹è¯• â€”â€” æ‰®æ¼”â€œåç«¯å·¥ç¨‹å¸ˆâ€

#### 1. è¿™æ­¥æ˜¯åœ¨å¹²å˜›ï¼Ÿï¼ˆå…¬å¸è§†è§’ï¼‰

è¡¨å»ºå¥½äº†ï¼Œç°åœ¨ä¸èƒ½æ€»æ˜¯æ‰‹åŠ¨è¿›å‘½ä»¤è¡Œæ•² SQL å­˜æ•°æ®ï¼Œå¤ªæ…¢äº†ã€‚\
æˆ‘ä»¬è¦å†™ä¸€æ®µ **Python ä»£ç **ï¼Œä½œä¸º**æ¢é’ˆ**ã€‚\
å¦‚æœè¿™ä¸ª Python è„šæœ¬èƒ½æˆåŠŸæ‰“å°å‡ºæ•°æ®åº“çš„ç‰ˆæœ¬å·ï¼Œè¯´æ˜\*\*â€œPython \<--\> æ•°æ®åº“â€\*\*çš„é€šä¿¡ç®¡é“å½»åº•æ‰“é€šäº†ã€‚è¿™æ˜¯å¼€å‘ä»»ä½•ç”Ÿä¿¡å¹³å°çš„ç¬¬ä¸€æ­¥ã€‚

#### 2. æ€ä¹ˆåšï¼Ÿï¼ˆå®æˆ˜æ“ä½œï¼‰

**â‘  å®‰è£…è¿æ¥é©±åŠ¨**\
åœ¨å…¬å¸é‡Œï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ psycopg2 è¿™ä¸ªåº“ã€‚å®ƒæ˜¯ PostgreSQL æœ€ç¨³å¥çš„ Python é€‚é…å™¨ã€‚\
(ç¡®ä¿ä½ å·²ç»å®‰è£…äº† python3 å’Œ pip)

``` bash
# å¦‚æœæ²¡æœ‰å®‰è£… pipï¼Œå…ˆè·‘è¿™å¥ï¼ˆæœ‰çš„è¯è·³è¿‡ï¼‰
sudo apt install python3-pip

# å®‰è£…é©±åŠ¨åº“
pip install psycopg2-binarycode
```

æŠŠä¸‹é¢çš„ä»£ç å¤åˆ¶è¿›å»ï¼ˆæ³¨æ„ä¿®æ”¹Â hostï¼Œå¦‚æœæ˜¯æœ¬åœ°å°±æ˜¯Â localhostï¼‰ï¼š

```{python}
import psycopg2
from psycopg2 import OperationalError

def test_connection():
    db_config = {
        "host": "localhost",
        "database": "omics_db",
        "user": "bio_admin",
        "password": "bio12345"
    }

    try:
        print("ğŸ”Œ æ­£åœ¨å°è¯•è¿æ¥æ•°æ®åº“...")
        # 1. å»ºç«‹è¿æ¥
        conn = psycopg2.connect(**db_config)
        
        # 2. åˆ›å»ºæ¸¸æ ‡ (ç›¸å½“äºåœ¨æ•°æ®åº“é‡Œæ‰“å¼€ä¸€ä¸ªæ“ä½œçª—å£)
        cur = conn.cursor()
        
        # 3. æ‰§è¡Œä¸€å¥ç®€å•çš„ SQLï¼šé—®é—®æ•°æ®åº“çš„ç‰ˆæœ¬
        cur.execute("SELECT version();")
        
        # 4. è·å–ç»“æœ
        db_version = cur.fetchone()
        
        print("âœ… è¿æ¥æˆåŠŸï¼")
        print(f"ğŸ“Š æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯: {db_version[0]}")
        
        # 5. å…³é—­è¿æ¥ (å¥½ä¹ æƒ¯ï¼šç”¨å®Œå…³ç¯)
        cur.close()
        conn.close()
        
    except OperationalError as e:
        print(f"âŒ è¿æ¥å¤±è´¥: {e}")
        print("ğŸ’¡ æç¤º: è¯·æ£€æŸ¥ pg_hba.conf é…ç½®æˆ–å¯†ç æ˜¯å¦æ­£ç¡®ã€‚")

if __name__ == "__main__":
    test_connection()
```

``` python
ğŸ”Œ æ­£åœ¨å°è¯•è¿æ¥æ•°æ®åº“...
âœ… è¿æ¥æˆåŠŸï¼
ğŸ“Š æ•°æ®åº“ç‰ˆæœ¬ä¿¡æ¯: PostgreSQL 16.11 (Ubuntu 16.11-0ubuntu0.24.04.1) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 13.3.0-6ubuntu2~24.04) 13.3.0, 64-bit
```

â€œåœ¨å»ºè¡¨æ—¶åšäº†å“ªäº›ä¼˜åŒ–ï¼Ÿâ€\
ï¼š

> â€œä¸ºäº†ä¿è¯æ•°æ®ä¸€è‡´æ€§ï¼Œæˆ‘åœ¨è¡¨è¾¾é‡è¡¨å’ŒåŸºå› è¡¨ä¹‹é—´å»ºç«‹äº†**å¤–é”®çº¦æŸ**ï¼ˆStep 3æ“ä½œï¼‰ï¼Œé˜²æ­¢è„æ•°æ®å½•å…¥ã€‚\
> åŒæ—¶ï¼Œè€ƒè™‘åˆ°ç”Ÿç‰©æ•°æ®é‡å¤§ï¼Œæˆ‘åœ¨ gene_symbol å’Œ sample_id è¿™ç§é«˜é¢‘æŸ¥è¯¢å­—æ®µä¸Šå»ºç«‹äº† **B-Tree ç´¢å¼•**ï¼Œè¿™èƒ½æ˜¾è‘—æé«˜ SELECT æŸ¥è¯¢çš„é€Ÿåº¦ã€‚â€

### å¤–é”®çº¦æŸçš„ä½œç”¨

-   **ä¿è¯æ•°æ®ä¸€è‡´æ€§** åœ¨ `expression_data` è¡¨é‡Œï¼Œ`gene_id` å¿…é¡»å­˜åœ¨äº `genes` è¡¨ä¸­ã€‚è¿™æ ·å¯ä»¥é˜²æ­¢æ’å…¥ä¸€ä¸ªä¸å­˜åœ¨çš„åŸºå›  IDï¼ˆè„æ•°æ®ï¼‰ã€‚ ä¾‹å¦‚ï¼Œå¦‚æœæœ‰äººè¯•å›¾æ’å…¥ï¼š

    ``` sql
    INSERT INTO expression_data (sample_id, gene_id, tpm_value)
    VALUES ('Sample_003', 'ENSG9999', 5.4321);
    ```

    è€Œ `ENSG9999` ä¸åœ¨ `genes` è¡¨ä¸­ï¼Œå°±ä¼šæŠ¥é”™ï¼Œé¿å…äº†æ— æ•ˆæ•°æ®è¿›å…¥ç³»ç»Ÿã€‚

-   **ç»´æŠ¤å‚ç…§å®Œæ•´æ€§** å¤–é”®çº¦æŸç¡®ä¿ä¸¤ä¸ªè¡¨ä¹‹é—´çš„å…³ç³»å§‹ç»ˆæœ‰æ•ˆï¼Œä¿è¯äº†æŸ¥è¯¢å’Œåˆ†ææ—¶ä¸ä¼šå‡ºç°â€œå­¤å„¿è®°å½•â€ã€‚

### ğŸ”¹ B-Tree ç´¢å¼•çš„ä½œç”¨

PostgreSQL é»˜è®¤çš„ç´¢å¼•ç»“æ„æ˜¯ **B-Tree**ï¼Œå®ƒç‰¹åˆ«é€‚åˆç­‰å€¼æŸ¥è¯¢å’ŒèŒƒå›´æŸ¥è¯¢ã€‚

-   **åœ¨** `genes(gene_symbol)` **ä¸Šå»ºç´¢å¼•**

    -   å¸¸è§æŸ¥è¯¢ï¼š`SELECT * FROM genes WHERE gene_symbol = 'TP53';`

    -   æœ‰äº†ç´¢å¼•åï¼Œæ•°æ®åº“ä¸éœ€è¦å…¨è¡¨æ‰«æï¼Œè€Œæ˜¯ç›´æ¥åœ¨ç´¢å¼•æ ‘é‡Œå®šä½åˆ° `TP53`ï¼Œé€Ÿåº¦å¤§å¹…æå‡ã€‚

-   **åœ¨** `expression_data(sample_id)` **ä¸Šå»ºç´¢å¼•**

    -   å¸¸è§æŸ¥è¯¢ï¼š`SELECT * FROM expression_data WHERE sample_id = 'Sample_001';`

    -   ç´¢å¼•èƒ½å¿«é€Ÿå®šä½åˆ°è¯¥æ ·æœ¬çš„æ‰€æœ‰åŸºå› è¡¨è¾¾æ•°æ®ï¼Œè€Œä¸æ˜¯é€è¡Œæ‰«ææ•´ä¸ªè¡¨ã€‚

    -   å¯¹å¤§è§„æ¨¡è½¬å½•ç»„æ•°æ®ï¼ˆæˆåƒä¸Šä¸‡åŸºå›  Ã— æˆç™¾ä¸Šåƒæ ·æœ¬ï¼‰ï¼Œè¿™ç§ä¼˜åŒ–éå¸¸å…³é”®ã€‚

------------------------------------------------------------------------

## ETL â€”â€” æ‰¹é‡ç”Ÿæˆå¹¶æ¸…æ´—å…¥åº“

### ğŸ“¥ Step 5ï¼šETL â€”â€” æ‰¹é‡ç”Ÿæˆå¹¶æ¸…æ´—å…¥åº“

è§’è‰²ï¼šæ•°æ®å·¥ç¨‹å¸ˆ / ç”Ÿä¿¡åˆ†æå¸ˆ

#### 1. è¿™æ­¥æ˜¯åœ¨å¹²å˜›ï¼Ÿ

æˆ‘ä»¬è¦å†™ä¸€ä¸ªè„šæœ¬ï¼Œä¸ä»…æ˜¯ç”Ÿæˆéšæœºæ•°ï¼Œè€Œæ˜¯è¦**æ„é€ ç¬¦åˆç”Ÿç‰©å­¦é€»è¾‘çš„å…³ç³»æ•°æ®**ã€‚

1.  å…ˆç”Ÿæˆ 500 ä¸ªåŸºå› ï¼ˆå­˜å…¥ genes è¡¨ï¼‰ã€‚

2.  å†ä¸ºè¿™ 500 ä¸ªåŸºå› ï¼Œæ¨¡æ‹Ÿå‡ºå®ƒä»¬åœ¨ä¸åŒæ ·æœ¬é‡Œçš„è¡¨è¾¾é‡ï¼ˆå­˜å…¥ expression_data è¡¨ï¼‰ã€‚

3.  **å…³é”®ç‚¹**ï¼šå¿…é¡»å…ˆå­˜åŸºå› ï¼Œå†å­˜è¡¨è¾¾é‡ï¼Œå¦åˆ™ä¼šè§¦å‘æˆ‘ä»¬åœ¨ Step 3 è®¾ç½®çš„**å¤–é”®æŠ¥é”™**ï¼ˆDatabase Integrity Errorï¼‰ã€‚

éœ€è¦å®‰è£… pandas å’Œ sqlalchemyï¼ˆPython çš„æ•°æ®åº“å·¥å…·åŒ…)

```{python}
import pandas as pd
import random
import string
import datetime
from sqlalchemy import create_engine

# ğŸ› ï¸ é…ç½®æ•°æ®åº“è¿æ¥ (User: bio_admin, DB: omics_db)
# æ ¼å¼: postgresql+psycopg2://ç”¨æˆ·å:å¯†ç @IPåœ°å€/æ•°æ®åº“å
#db_url = "postgresql+psycopg2://bio_admin:bio12345@localhost/omics_db"
db_url = "postgresql://neondb_owner:npg_KracX4hO7jAf@ep-falling-bird-a4m0z2kx-pooler.us-east-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require"
#psql 'postgresql://neondb_owner:npg_KracX4hO7jAf@ep-falling-bird-a4m0z2kx-pooler.us-east-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require'
engine = create_engine(db_url)

# ===========================
# ğŸ§¬ 1. æ¨¡æ‹Ÿç”Ÿæˆ Genes æ•°æ®
# ===========================
NUM_GENES = 500

# ä¸ºäº†ä¿è¯ ENSG ID å”¯ä¸€ï¼Œæˆ‘ä»¬ä» 100-10000 ä¸­éšæœºæŠ½å– 500 ä¸ªä¸é‡å¤çš„æ•°å­—
id_pool = random.sample(range(100, 10001), NUM_GENES)

# åŸºå› åŠŸèƒ½æè¿°æ±  (æ¨¡æ‹ŸçœŸå®æè¿°)
descriptions_pool = [
    "Regulation of transcription by RNA polymerase II",
    "G-protein coupled receptor signaling pathway",
    "ATP binding and kinase activity",
    "Integral component of plasma membrane",
    "DNA repair and recombination proteins",
    "Cell cycle checkpoint signaling",
    "Growth factor activity and receptor binding",
    "Immune response and inflammatory signaling"
]

genes_list = []
used_symbols = set() # ç”¨æ¥é˜²æ­¢åŸºå› åé‡å¤

print(f"ğŸ”„ æ­£åœ¨ç”Ÿæˆ {NUM_GENES} æ¡åŸºå› å…ƒæ•°æ®...")

for i in range(NUM_GENES):
    # A. æ„é€  Gene ID: ENSG + éšæœºæ•°å­—
    g_id = f"ENSG{id_pool[i]}"
    
    # B. æ„é€  Gene Symbol: å¤§å†™å­—æ¯(3-4ä¸ª) + æ•°å­—(1-2ä¸ª)ï¼Œç¡®ä¿å­—æ¯å¤šäºæ•°å­—
    while True:
        # éšæœº 3-4 ä¸ªå­—æ¯
        letters = ''.join(random.choices(string.ascii_uppercase, k=random.randint(3, 4)))
        # éšæœº 1-2 ä¸ªæ•°å­—
        nums = str(random.randint(1, 99))
        symbol = letters + nums
        if symbol not in used_symbols:
            used_symbols.add(symbol)
            break
    
    # C. æŸ“è‰²ä½“: chr1 - chr21
    chrom = f"chr{random.randint(1, 21)}"
    
    # D. æè¿°: éšæœºé€‰
    desc = random.choice(descriptions_pool)
    
    # E. æ—¶é—´: 2025å¹´ï¼Œæ—¥æœˆéšæœº
    month = random.randint(1, 12)
    # ç®€å•å¤„ç†æ—¥æœŸï¼Œé¿å…å¤§å°æœˆé—®é¢˜ï¼Œç»Ÿå–1-28å·
    day = random.randint(1, 28) 
    created_time = datetime.datetime(2025, month, day)

    genes_list.append({
        "gene_id": g_id,
        "gene_symbol": symbol,
        "chromosome": chrom,
        "description": desc,
        "created_at": created_time
    })

# è½¬ä¸º DataFrame
df_genes = pd.DataFrame(genes_list)

# ===========================
# ğŸ§ª 2. æ¨¡æ‹Ÿç”Ÿæˆ Expression æ•°æ®
# ===========================
expr_list = []
# å‡è®¾æˆ‘ä»¬æœ‰ 3 ä¸ªæ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬éƒ½æµ‹äº†è¿™ 500 ä¸ªåŸºå› 
samples = ["Sample_001", "Sample_002", "Sample_003"]

print(f"ğŸ”„ æ­£åœ¨ä¸ºæ ·æœ¬ç”Ÿæˆè¡¨è¾¾é‡æ•°æ®...")

for samp in samples:
    for g_id in df_genes['gene_id']: # å¿…é¡»ä½¿ç”¨ä¸Šé¢ç”Ÿæˆçš„ gene_idï¼Œå¦åˆ™æŠ¥é”™
        # è¡¨è¾¾é‡: 0.1 åˆ° 100 ä¹‹é—´çš„éšæœºæµ®ç‚¹æ•°
        val = round(random.uniform(0.1, 100.0), 4)
        
        expr_list.append({
            "sample_id": samp,
            "gene_id": g_id,
            "tpm_value": val,
            "sequencing_date": datetime.date.today()
        })

df_expr = pd.DataFrame(expr_list)

# ===========================
# ğŸš€ 3. æ‰§è¡Œå†™å…¥ (ETL Load)
# ===========================
try:
    print("ğŸ“¥ æ­£åœ¨å†™å…¥æ•°æ®åº“ 'genes' è¡¨...")
    # if_exists='append' è¡¨ç¤ºè¿½åŠ ï¼Œindex=False è¡¨ç¤ºä¸æŠŠ pandas çš„ç´¢å¼•å·å†™è¿›å»
    df_genes.to_sql('genes', engine, if_exists='append', index=False)
    print(f"   âœ… æˆåŠŸå†™å…¥ {len(df_genes)} æ¡åŸºå› æ•°æ®")

    print("ğŸ“¥ æ­£åœ¨å†™å…¥æ•°æ®åº“ 'expression_data' è¡¨...")
    df_expr.to_sql('expression_data', engine, if_exists='append', index=False)
    print(f"   âœ… æˆåŠŸå†™å…¥ {len(df_expr)} æ¡è¡¨è¾¾é‡æ•°æ®")

    print("\nğŸ‰ å…¨æµç¨‹ ETL ä»»åŠ¡å®Œæˆï¼æ•°æ®åº“ä¸å†ç©ºè™šã€‚")

except Exception as e:
    print(f"\nâŒ å‘ç”Ÿé”™è¯¯: {e}")
    print("æç¤ºï¼šå¦‚æœæ˜¯å”¯ä¸€æ€§çº¦æŸæŠ¥é”™ï¼Œè¯·æ¸…ç©ºè¡¨åé‡è¯•ã€‚")
```

å¾—åˆ°

``` python
ğŸ”„ æ­£åœ¨ç”Ÿæˆ 500 æ¡åŸºå› å…ƒæ•°æ®...
ğŸ”„ æ­£åœ¨ä¸ºæ ·æœ¬ç”Ÿæˆè¡¨è¾¾é‡æ•°æ®...
ğŸ“¥ æ­£åœ¨å†™å…¥æ•°æ®åº“ 'genes' è¡¨...
   âœ… æˆåŠŸå†™å…¥ 500 æ¡åŸºå› æ•°æ®
ğŸ“¥ æ­£åœ¨å†™å…¥æ•°æ®åº“ 'expression_data' è¡¨...
   âœ… æˆåŠŸå†™å…¥ 1500 æ¡è¡¨è¾¾é‡æ•°æ®

ğŸ‰ å…¨æµç¨‹ ETL ä»»åŠ¡å®Œæˆï¼æ•°æ®åº“ä¸å†ç©ºè™š
```

ç”¨ `pandas` + `psycopg2`çœ‹çœ‹data

```{python}
import psycopg2
import pandas as pd

conn = psycopg2.connect(
    dbname="omics_db",
    user="bio_admin",
    password="bio12345",
    host="localhost",   # æˆ–è€… "127.0.0.1"
    port="5432"
)

# ç¤ºä¾‹ï¼šæŸ¥çœ‹ genes è¡¨å‰ 20 è¡Œ
genes_df = pd.read_sql("SELECT * FROM genes LIMIT 20;", conn)
print(genes_df)

# ç¤ºä¾‹ï¼šæŸ¥çœ‹ expression_data è¡¨å‰ 20 è¡Œ
expr_df = pd.read_sql("SELECT * FROM expression_data LIMIT 20;", conn)
print(expr_df)

conn.close()

```

``` python
    gene_id SELECT gene_symbol, expression_value
FROM expression_data
WHERE expression_value > 95;
chromosome  \
0   ENSG9026       ZDLB4       chr4   
1    ENSG859      KFXX28      chr14   
2   ENSG8890       IQH35      chr16   
3   ENSG6287       TMR40       chr3   
4   ENSG5899       IJP20       chr4   
5   ENSG3552       FAA57      chr17   
6   ENSG5194       SXH58       chr4   
7    ENSG766      JPFF14       chr8   
8   ENSG1118       KWC26      chr15   
9   ENSG2379       DSC63      chr21   
10  ENSG8931       WZH25      chr18   
11  ENSG4855       RYH31      chr12   
12  ENSG9403      KVVI40       chr9   
13   ENSG929      ZXKL76      chr20   
14  ENSG7280       XTD75      chr20   
15  ENSG6286       QPY71       chr1   
16  ENSG1075       ZDO47       chr2   
17  ENSG4133       OKP36      chr14   
18  ENSG8415      VCBS69      chr16   
19  ENSG1251       OKW67       chr1   

                                         description created_at  
0              Integral component of plasma membrane 2025-07-01  
1        Growth factor activity and receptor binding 2025-03-05  
2              Integral component of plasma membrane 2025-01-06  
3   Regulation of transcription by RNA polymerase II 2025-08-24  
4   Regulation of transcription by RNA polymerase II 2025-11-05  
5       G-protein coupled receptor signaling pathway 2025-12-24  
6   Regulation of transcription by RNA polymerase II 2025-12-19  
7       G-protein coupled receptor signaling pathway 2025-07-10  
8       G-protein coupled receptor signaling pathway 2025-04-14  
9                    Cell cycle checkpoint signaling 2025-11-11  
10             DNA repair and recombination proteins 2025-12-05  
11                   ATP binding and kinase activity 2025-04-21  
12             DNA repair and recombination proteins 2025-02-11  
13        Immune response and inflammatory signaling 2025-05-23  
14                   ATP binding and kinase activity 2025-11-23  
15                   ATP binding and kinase activity 2025-05-13  
16                   Cell cycle checkpoint signaling 2025-06-14  
17      G-protein coupled receptor signaling pathway 2025-03-25  
18       Growth factor activity and receptor binding 2025-04-08  
19        Immune response and inflammatory signaling 2025-09-22 


    id   sample_id   gene_id  tpm_value sequencing_date
0    1  Sample_001  ENSG9026    43.5729      2025-12-05
1    2  Sample_001   ENSG859    30.2089      2025-12-05
2    3  Sample_001  ENSG8890    42.2554      2025-12-05
3    4  Sample_001  ENSG6287    29.0419      2025-12-05
4    5  Sample_001  ENSG5899    90.0628      2025-12-05
5    6  Sample_001  ENSG3552    97.5578      2025-12-05
6    7  Sample_001  ENSG5194    52.2938      2025-12-05
7    8  Sample_001   ENSG766    61.9013      2025-12-05
8    9  Sample_001  ENSG1118    72.4806      2025-12-05
9   10  Sample_001  ENSG2379     4.3963      2025-12-05
10  11  Sample_001  ENSG8931    34.6849      2025-12-05
11  12  Sample_001  ENSG4855     9.6502      2025-12-05
12  13  Sample_001  ENSG9403    48.4030      2025-12-05
13  14  Sample_001   ENSG929    44.8528      2025-12-05
14  15  Sample_001  ENSG7280    67.6332      2025-12-05
15  16  Sample_001  ENSG6286    69.8823      2025-12-05
16  17  Sample_001  ENSG1075    29.5884      2025-12-05
17  18  Sample_001  ENSG4133    33.4940      2025-12-05
18  19  Sample_001  ENSG8415    38.8696      2025-12-05
19  20  Sample_001  ENSG1251    27.5694      2025-12-05
```

### ä¸šåŠ¡æŸ¥è¯¢å®æˆ˜ â€”â€” æ¨¡æ‹Ÿâ€œç”Ÿä¿¡åˆ†æå·¥å…·â€

è§’è‰²ï¼šåç«¯å¼€å‘ / ç”Ÿä¿¡ç§‘å­¦å®¶

ç°åœ¨æ•°æ®åº“é‡Œæœ‰è´§äº†ã€‚å…¬å¸é‡Œçš„åˆ†æå¸ˆï¼ˆæˆ–å‰ç«¯é¡µé¢ï¼‰ä¼šæå‡ºä¸€ä¸ªå…·ä½“éœ€æ±‚ï¼š

> **éœ€æ±‚ï¼š** "èƒ½ä¸èƒ½å¸®æˆ‘æŠŠ **Sample_001** æ ·æœ¬é‡Œï¼Œä½äº **chr7** ä¸Šï¼Œä¸”è¡¨è¾¾é‡ **å¤§äº 80.0 TPM** çš„é‚£äº›é«˜è¡¨è¾¾åŸºå› æ‰¾å‡ºæ¥ï¼Ÿæˆ‘æƒ³çœ‹çœ‹å®ƒä»¬æ˜¯å¹²å˜›çš„ã€‚"

å¦‚æœä½ ä¼šå†™è¿™ä¸ª Python è„šæœ¬ï¼Œä½ å°±å®Œæˆäº†åç«¯æ¥å£çš„æ ¸å¿ƒé€»è¾‘ã€‚

```{python}
import pandas as pd
from sqlalchemy import create_engine, text

# å»ºç«‹è¿æ¥
#db_url = "postgresql+psycopg2://bio_admin:bio12345@localhost/omics_db"
db_url = "postgresql://neondb_owner:npg_HPLtg5ZoJr9T@ep-young-star-a40a3qer-pooler.us-east-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require"
engine = create_engine(db_url)

def search_high_expression_genes(sample, chromosome, min_tpm):
    print(f"ğŸ” æ­£åœ¨æ£€ç´¢: æ ·æœ¬={sample}, æŸ“è‰²ä½“={chromosome}, é˜ˆå€¼>{min_tpm}")
    
    # ğŸ“ ç¼–å†™ SQL (è¿™æ˜¯åç«¯æœ€æ ¸å¿ƒçš„æŠ€èƒ½ï¼šJoin æŸ¥è¯¢)
    # æˆ‘ä»¬è¦è”åˆä¸¤å¼ è¡¨ï¼š
    # 1. genes è¡¨ (æ‹¿ gene_symbol, description)
    # 2. expression_data è¡¨ (æ‹¿ tpm_value)
    # è¿æ¥ç‚¹æ˜¯ gene_id
    
    sql_query = text("""
        SELECT 
            g.gene_symbol,
            g.chromosome,
            e.tpm_value,
            g.description,
            g.created_at
        FROM expression_data e
        JOIN genes g ON e.gene_id = g.gene_id
        WHERE e.sample_id = :sample 
          AND g.chromosome = :chrom
          AND e.tpm_value > :min_tpm
        ORDER BY e.tpm_value DESC;
    """)
    
    # ä½¿ç”¨ Pandas ç›´æ¥è¯»å– SQL ç»“æœï¼Œéå¸¸æ–¹ä¾¿
    with engine.connect() as conn:
        df_result = pd.read_sql(sql_query, conn, params={
            "sample": sample,
            "chrom": chromosome,
            "min_tpm": min_tpm
        })
    
    return df_result

if __name__ == "__main__":
    # æ¨¡æ‹Ÿä¸€æ¬¡æŸ¥è¯¢
    target_sample = "Sample_001"
    target_chr = "chr7"  # æˆ‘ä»¬çš„æ¨¡æ‹Ÿæ•°æ®é‡Œæœ‰ chr1 - chr21
    cutoff = 50.0      # æ‰¾å¤§äº 50 TPM çš„
    
    result = search_high_expression_genes(target_sample, target_chr, cutoff)
    
    if not result.empty:
        print(f"\nâœ… æŸ¥è¯¢æˆåŠŸï¼å…±æ‰¾åˆ° {len(result)} ä¸ªç›®æ ‡åŸºå› ï¼š\n")
        # æ‰“å°å¥½çœ‹çš„è¡¨æ ¼
        print(result.to_string(index=False))
        
        # æ¨¡æ‹Ÿå¯¼å‡ºæˆ Excel/CSV ç»™ç”Ÿç‰©å­¦å®¶
        result.to_csv("report_chr7_high_expr.csv", index=False)
        print("\nğŸ“„ ç»“æœå·²è‡ªåŠ¨å¯¼å‡ºä¸º report_chr7_high_expr.csv")
    else:
        print("\nâš ï¸ æœªæ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„åŸºå› ï¼Œå¯èƒ½æ˜¯éšæœºç”Ÿæˆçš„æ•°å€¼å¤ªå°ï¼Œè¯•ç€æŠŠ cutoff è°ƒä½ä¸€ç‚¹ï¼Ÿ")
```

``` python
ğŸ” æ­£åœ¨æ£€ç´¢: æ ·æœ¬=Sample_001, æŸ“è‰²ä½“=chr7, é˜ˆå€¼>50.0

âœ… æŸ¥è¯¢æˆåŠŸï¼å…±æ‰¾åˆ° 9 ä¸ªç›®æ ‡åŸºå› ï¼š

gene_symbol chromosome  tpm_value                                      description created_at
     MMAC53       chr7    94.9056            DNA repair and recombination proteins 2025-10-24
      OMP76       chr7    84.3437      Growth factor activity and receptor binding 2025-09-17
      DVEU3       chr7    83.0531            DNA repair and recombination proteins 2025-01-12
      HIUN6       chr7    78.9908     G-protein coupled receptor signaling pathway 2025-06-13
     WKZL38       chr7    68.4037 Regulation of transcription by RNA polymerase II 2025-10-11
     CJCL97       chr7    66.9587     G-protein coupled receptor signaling pathway 2025-07-09
     QQPO86       chr7    66.7273            DNA repair and recombination proteins 2025-11-02
     PDLM93       chr7    55.2128            Integral component of plasma membrane 2025-10-12
      RUO36       chr7    53.1132                  ATP binding and kinase activity 2025-06-09

ğŸ“„ ç»“æœå·²è‡ªåŠ¨å¯¼å‡ºä¸º report_chr7_high_expr.csv
```

### ğŸ§¬ Step 7: æ¶æ„å‡çº§ â€”â€” æ–°å¢è¡¨ä¸æ•°æ®å…³è”

è§’è‰²ï¼šDBA / æ•°æ®æ¶æ„å¸ˆ

æˆ‘ä»¬éœ€è¦æ–°å¢ä¸€å¼ è¡¨ sample_infoï¼Œç”¨æ¥è®°å½•æ ·æœ¬çš„ä¸´åºŠä¿¡æ¯ï¼ˆæ¯”å¦‚ç»„ç»‡ç±»å‹ã€ç–¾ç—…çŠ¶æ€ï¼‰ï¼Œå¹¶æŠŠå®ƒå’Œç°æœ‰çš„ expression_data å…³è”èµ·æ¥ã€‚

#### 1. ç™»å½•æ•°æ®åº“

``` bash
psql -h localhost -U bio_admin -d omics_db
```

#### 2. æ‰§è¡Œ SQLï¼šåˆ›å»ºæ–°è¡¨

æˆ‘ä»¬åœ¨ ETL é˜¶æ®µç”Ÿæˆäº†ä¸‰ä¸ªæ ·æœ¬ï¼šSample_001, Sample_002, Sample_003ã€‚æˆ‘ä»¬è¦ç»™å®ƒä»¬ä¸Šæˆ·å£ã€‚

``` sql
-- 1. åˆ›å»ºæ ·æœ¬ä¸´åºŠä¿¡æ¯è¡¨
CREATE TABLE sample_info (
    sample_id VARC12AR(50) PRIMARY KEY, -- å’Œ expression_data é‡Œçš„ sample_id å¯¹åº”
    tissue_type VARCHAR(50),           -- ç»„ç»‡ç±»å‹ (å¦‚ Lung, Liver)
    condition VARCHAR(50),             -- ç–¾ç—…çŠ¶æ€ (å¦‚ Tumor, Normal)
    patient_age INT                    -- ç—…äººå¹´é¾„
);

-- 2. æ’å…¥æ•°æ® (è¡¥å……å…ƒæ•°æ®)
-- æˆ‘ä»¬æ‰‹åŠ¨å½•å…¥è¿™ 3 ä¸ªæ ·æœ¬çš„ä¿¡æ¯ï¼Œæ¨¡æ‹ŸçœŸå®çš„ä¸´åºŠè®°å½•
INSERT INTO sample_info (sample_id, tissue_type, condition, patient_age) VALUES
('Sample_001', 'Lung', 'Tumor', 65),
('Sample_002', 'Lung', 'Normal', 65),
('Sample_003', 'Liver', 'Tumor', 42);

-- 3. éªŒè¯ä¸€ä¸‹
SELECT * FROM sample_info;
```

``` sql
omics_db=> CREATE TABLE sample_info (
    sample_id VARCHAR(50) PRIMARY KEY, -- å’Œ expression_data é‡Œçš„ sample_id å¯¹åº”
    tissue_type VARCHAR(50),           -- ç»„ç»‡ç±»å‹ (å¦‚ Lung, Liver)
    condition VARCHAR(50),             -- ç–¾ç—…çŠ¶æ€ (å¦‚ Tumor, Normal)
    patient_age INT                    -- ç—…äººå¹´é¾„
);
CREATE TABLE
omics_db=> INSERT INTO sample_info (sample_id, tissue_type, condition, patient_age) VALUES
('Sample_001', 'Lung', 'Tumor', 65),
('Sample_002', 'Lung', 'Normal', 65),
('Sample_003', 'Liver', 'Tumor', 42);
INSERT 0 3
omics_db=> SELECT * FROM sample_info;
 sample_id  | tissue_type | condition | patient_age 
------------+-------------+-----------+-------------
 Sample_001 | Lung        | Tumor     |          65
 Sample_002 | Lung        | Normal    |          65
 Sample_003 | Liver       | Tumor     |          42
(3 rows)

omics_db=>
```

## ğŸš€ Step 8: æ„å»º Web API â€”â€” FastAPI åç«¯å¼€å‘

è§’è‰²ï¼šåç«¯å¼€å‘å·¥ç¨‹å¸ˆ

è¿™æ˜¯ç°åœ¨**æœ€å€¼é’±**çš„æŠ€èƒ½ä¹‹ä¸€ã€‚æˆ‘ä»¬å°†ç”¨ Python å†™ä¸€ä¸ªå¾®æœåŠ¡ï¼Œå½“æµè§ˆå™¨å‘èµ·è¯·æ±‚æ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å»æ•°æ®åº“æ‰§è¡Œ SQLï¼ŒæŠŠç»“æœå˜æˆ JSON æ ¼å¼æ‰”ç»™æµè§ˆå™¨ã€‚

#### 1. å®‰è£… FastAPI åŠå…¶ä¾èµ–

-   ***`fastapi`***: æ¡†æ¶æœ¬ä½“ã€‚

-   ***`uvicorn`***: ä¸€ä¸ªè¶…å¿«çš„æœåŠ¡å™¨ï¼Œç”¨æ¥è·‘ FastAPIã€‚

``` python
pip install fastapi uvicorn
```

#### 2. ç¼–å†™åç«¯ä¸»ç¨‹åº

æ–°å»ºæ–‡ä»¶ ***`main.py`***ï¼ˆè¿™æ˜¯ FastAPI çš„æ ‡å‡†å…¥å£æ–‡ä»¶åï¼‰

## ğŸ“¡ Step 9: å¯åŠ¨æœåŠ¡ä¸æµ‹è¯•

è§’è‰²ï¼šè¿ç»´ / éƒ¨ç½²å·¥ç¨‹å¸ˆ

#### 1. å¯åŠ¨ API æœåŠ¡

ä½¿ç”¨ `uvicorn` å¯åŠ¨æœåŠ¡å™¨ã€‚

-   --reload: ä»£ç ä¸€æ”¹ï¼ŒæœåŠ¡è‡ªåŠ¨é‡å¯ï¼ˆå¼€å‘æ¨¡å¼ç¥å™¨ï¼‰ã€‚

-   --host 0.0.0.0: å…è®¸å¤–éƒ¨è®¿é—®ï¼ˆä¸ä»…ä»…æ˜¯ localhostï¼‰ã€‚

``` bash
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

#### 2. æµ‹è¯•æ•ˆæœï¼ˆæœ€æ¿€åŠ¨äººå¿ƒçš„ä¸€æ­¥ï¼‰

ä½ éœ€è¦å…ˆçŸ¥é“ä½ è‡ªå·±ç”Ÿæˆçš„åŸºå› åæ˜¯ä»€ä¹ˆã€‚\
å› ä¸ºæˆ‘ä»¬åˆšæ‰åœ¨ ETL é‡Œç”Ÿæˆçš„åŸºå› åæ˜¯ **éšæœºå­—æ¯+æ•°å­—** (ä¾‹å¦‚ ABC12, XYZ88)ã€‚\
å…ˆåœ¨ç»ˆç«¯é‡Œç„ä¸€çœ¼æœ‰å“ªäº›åŸºå› åï¼Œä¸ç„¶ç›²çŒœçŒœä¸åˆ°ï¼š\
(ä½ å¯ä»¥æ–°å¼€ä¸€ä¸ªç»ˆç«¯çª—å£ï¼Œç™»å½• psql æ‰§è¡Œ SELECT gene_symbol FROM genes LIMIT 5; çœ‹å‡ ä¸ªåå­—)

``` bash
ad main:app
INFO:     Will watch for changes in these directories: ['D:\\acode\\datasql\\script']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [6360] using StatReload
INFO:     Started server process [12028]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     127.0.0.1:64464 - "GET /docs?_positronRender%3D0 HTTP/1.1" 200 OK
INFO:     127.0.0.1:64464 - "GET /openapi.json HTTP/1.1" 200 OK
INFO:     127.0.0.1:51106 - "GET /docs HTTP/1.1" 200 OK
INFO:     127.0.0.1:51106 - "GET /openapi.json HTTP/1.1" 200 OK
INFO:     127.0.0.1:65116 - "GET /get_gene?name=OMP36 HTTP/1.1" 200 OK
INFO:     127.0.0.1:61406 - "GET /get_gene?name=OMP76 HTTP/1.1" 200 OK
```

![](images/å±å¹•æˆªå›¾_5-12-2025_194745_127.0.0.1.jpeg)

------------------------------------------------------------------------

### ğŸš€ Step 10: Docker åŒ–éƒ¨ç½²ï¼ˆæ‰“åŒ…ä½ çš„åº”ç”¨ï¼‰

å‡è®¾ä½ ç°åœ¨çš„ä»£ç éƒ½åœ¨ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œï¼ˆæ¯”å¦‚ `~/omics_project`ï¼‰ï¼Œé‡Œé¢æœ‰ `main.py` ç­‰æ–‡ä»¶ã€‚

#### 1. å®‰è£… Dockerï¼ˆå¦‚æœè¿˜æ²¡æœ‰çš„è¯ï¼‰

åœ¨ä½ çš„ Ubuntu æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

``` bash
sudo apt update
sudo apt install docker.io -y
sudo systemctl start docker
sudo systemctl enable docker
# æŠŠä½ è‡ªå·±åŠ åˆ° docker ç”¨æˆ·ç»„ï¼ˆé¿å…æ¯æ¬¡éƒ½è¦ sudoï¼‰
sudo usermod -aG docker $USER
```

*(æ³¨æ„ï¼šæ‰§è¡Œå®Œæœ€åä¸€è¡Œéœ€è¦æ³¨é”€é‡æ–°ç™»å½•ä¸€ä¸‹æœåŠ¡å™¨ï¼Œæˆ–è€…ç›´æ¥ç”¨ sudo è·‘ docker å‘½ä»¤ä¹Ÿå¯ä»¥)*

#### 2. ç”Ÿæˆä¾èµ–æ¸…å• (requirements.txt)

Python éœ€è¦çŸ¥é“ä½ è¦è£…å“ªäº›åº“ã€‚åœ¨é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œï¼š

``` bash
pip freeze > requirements.txt
```

æ‰“å¼€çœ‹çœ‹ `requirements.txt`ï¼Œé‡Œé¢åº”è¯¥æœ‰ `fastapi`, `uvicorn`, `psycopg2-binary`, `sqlalchemy`, `pandas` ç­‰ã€‚

#### 3. ç¼–å†™ Dockerfile

è¿™æ˜¯ Docker çš„è¯´æ˜ä¹¦ã€‚æ–°å»ºæ–‡ä»¶ `Dockerfile`12æ²¡æœ‰åç¼€åï¼‰ï¼š

``` bash
nano Dockerfile
```

å†™å…¥å†…å®¹ï¼š

``` dockerfile
# 1. é€‰ä¸€ä¸ª Python åŸºç¡€é•œåƒ (è½»é‡ç‰ˆ)
FROM python:3.9-slim

# 2. è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# 3. å…ˆæŠŠä¾èµ–æ–‡ä»¶æ‹·è´è¿›å»
COPY requirements.txt .

# 4. å®‰è£…ä¾èµ– (åŠ  -i æ˜¯ä¸ºäº†ç”¨å›½å†…æºä¸‹è½½å¿«ä¸€ç‚¹ï¼Œå¦‚æœåœ¨å›½å¤–å¯å»æ‰)
RUN pip install --no-cache-dir -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# 5. æŠŠä½ çš„ä»£ç æ–‡ä»¶éƒ½æ‹·è¿›å»
COPY . .

# 6. å‘Šè¯‰å®¹å™¨æˆ‘ä»¬è¦æš´éœ² 8000 ç«¯å£
EXPOSE 8000

# 7. å¯åŠ¨å‘½ä»¤
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

#### 4. ğŸš‘ é‡è¦ä¿®æ”¹ï¼šä¿®æ”¹æ•°æ®åº“è¿æ¥ IP

**è¿™æ˜¯å°ç™½æœ€å®¹æ˜“è¸©çš„å‘ï¼Œè¯·ä»”ç»†çœ‹ï¼**

åœ¨ `main.py` é‡Œï¼Œä½ ä¹‹å‰å†™çš„æ˜¯ `localhost`ã€‚ ä½†æ˜¯ï¼Œå½“ä½ çš„ä»£ç è·‘åœ¨ Docker **å®¹å™¨é‡Œ**æ—¶ï¼Œå®¹å™¨é‡Œçš„ `localhost` æŒ‡çš„æ˜¯å®¹å™¨è‡ªå·±ï¼Œè€Œä¸æ˜¯å¤–é¢çš„æœåŠ¡å™¨ï¼ˆå®¿ä¸»æœºï¼‰ã€‚å®¹å™¨æ‰¾ä¸åˆ°æ•°æ®åº“ï¼Œå°±ä¼šæŠ¥é”™ã€‚

æˆ‘ä»¬éœ€è¦ä¿®æ”¹ `main.py` é‡Œçš„ `DB_URL`ã€‚

-   **æ–¹æ³• A (æœ€é€šç”¨)**: å¦‚æœä½ å·²ç»é…ç½®äº† PostgreSQL å…è®¸è¿œç¨‹è¿æ¥ (Step 3 åšçš„ `0.0.0.0/0`)ï¼Œå¹¶ä¸”ä½ è¦éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Œå°±æŠŠ `localhost` æ”¹æˆä½ **æœåŠ¡å™¨çš„å†…ç½‘ IP** (æˆ–è€… Docker çš„ç½‘å…³ IP `172.17.0.1`)ã€‚
-   **æ–¹æ³• B (Linux å¿«æ·æ–¹å¼)**: å°† `localhost` æ”¹ä¸º `172.17.0.1` (è¿™æ˜¯ Docker é»˜è®¤èƒ½è®¿é—®å®¿ä¸»æœºçš„é€šé“)ã€‚

æˆ‘ä»¬ä¿®æ”¹ `main.py`ï¼š

``` python
# ä¿®æ”¹è¿™ä¸€è¡Œ
DB_URL = "postgresql+psycopg2://bio_admin:bio12345@172.17.0.1/omics_db"
```

*(æ³¨ï¼šå‰ææ˜¯ä½ çš„ PostgreSQL pg_hba.conf é‡Œå…è®¸äº†ç½‘ç»œè¿æ¥ï¼Œæˆ‘ä»¬åœ¨ Step 3 åšè¿‡äº†)*

------------------------------------------------------------------------

### ğŸ—ï¸ Step 11: æ„å»ºå¹¶å¯åŠ¨æœåŠ¡

#### 1. æ‰“åŒ…ï¼ˆBuildï¼‰

ç»™ä½ çš„é•œåƒå–ä¸ªåå­—ï¼Œæ¯”å¦‚ `bio_app_v1`ã€‚

``` bash
# æ³¨æ„æœ€åæœ‰ä¸ªç‚¹ "." ä»£è¡¨å½“å‰ç›®å½•
sudo docker build -t bio_app_v1 .
```

ä½ ä¼šçœ‹åˆ°ä¸€ç³»åˆ—æ­¥éª¤ï¼ˆDownloading... Installing...ï¼‰ï¼Œæœ€åæ˜¾ç¤º Successfully builtã€‚

### *å‡ºç°é—®é¢˜ï¼š*

``` bash
(base) jayz@WIN-92H1MBQ8SBB:/mnt/d/acode/datasql/script$ sudo docker build -t bio_app_v1 .
DEPRECATED: The legacy builder is deprecated and will be removed in a future release.
            Install the buildx component to build images with BuildKit:
            https://docs.docker.com/go/buildx/

Sending build context to Docker daemon  1.062MB
Step 1/7 : FROM python:3.12-slim
Get "https://registry-1.docker.io/v2/": context deadline exceeded
```

è¿™æ˜¯å› ä¸ºÂ **Docker Hub çš„å®˜æ–¹ä»“åº“åœ¨å›½å¤–**ï¼Œåœ¨å›½å†…çš„ç½‘ç»œç¯å¢ƒä¸‹ï¼Œä¸ç”¨â€œé­”æ³•â€æˆ–è€…æ˜¯â€œå›½å†…é•œåƒåŠ é€Ÿâ€ï¼ŒåŸºæœ¬æ˜¯æ‹‰ä¸ä¸‹æ¥Â python:3.12-slimÂ è¿™ä¸ªåŸºç¡€é•œåƒçš„

### ğŸ› ï¸ è§£å†³æ–¹æ³•ï¼šé…ç½® Docker å›½å†…é•œåƒåŠ é€Ÿï¼ˆæ¨èï¼‰

æˆ‘ä»¬éœ€è¦å‘Šè¯‰ Dockerï¼šâ€œåˆ«å»ç¾å›½æ‹‰æ•°æ®äº†ï¼Œå»å›½å†…çš„é˜¿é‡Œäº‘/ç½‘æ˜“äº‘æ‹‰ã€‚â€

**æ­¥éª¤å¦‚ä¸‹ï¼š**

#### 1. ç¼–è¾‘ Docker é…ç½®æ–‡ä»¶

åœ¨ä½ çš„ WSL ç»ˆç«¯é‡Œæ‰§è¡Œï¼š

``` bash
sudo nano /etc/docker/daemon.json
```

å¦‚æœè¿™ä¸ªæ–‡ä»¶åŸæœ¬ä¸å­˜åœ¨ï¼Œæ˜¯ä¸€ä¸ªç©ºæ–‡ä»¶ï¼Œå®Œå…¨æ²¡é—®é¢˜ï¼Œç›´æ¥æ–°å»º)

#### 2. å¡«å…¥é•œåƒæºåœ°å€

æŠŠä¸‹é¢çš„å†…å®¹å®Œæ•´å¤åˆ¶ç²˜è´´è¿›å»ã€‚\
è¿™é‡Œæˆ‘åˆ—äº†å‡ ä¸ªç›®å‰åœ¨å›½å†…è¿˜æ¯”è¾ƒç¨³çš„é•œåƒæºï¼ˆç”±äºç°åœ¨å¾ˆå¤šé•œåƒæºå¶å°”ä¸ç¨³å®šï¼Œæˆ‘ä»¬å¤šé…å‡ ä¸ªï¼‰ï¼š

```         
{
  "registry-mirrors": [
    "https://docker.m.daocloud.io",
    "https://huecker.io",
    "https://dockerhub.timeweb.cloud",
    "https://noohub.ru"
  ]
}
```

(æ³¨æ„ï¼šDocker å®˜æ–¹æºæœ€è¿‘åœ¨å›½å†…å¹²æ‰°å¾ˆä¸¥é‡ï¼Œä¸Šé¢è¿™äº›æ˜¯ç¬¬ä¸‰æ–¹ä»£ç†é•œåƒã€‚å¦‚æœæœ‰é˜¿é‡Œäº‘è´¦å·ï¼Œå»é˜¿é‡Œäº‘æœâ€œå®¹å™¨é•œåƒæœåŠ¡â€æ‹¿åˆ°ä¸“å±åŠ é€Ÿå™¨åœ°å€æ˜¯æœ€å¥½çš„)

æŒ‰ Ctrl + O -\> Enter ä¿å­˜ï¼ŒCtrl + X é€€å‡ºã€‚

#### 3. é‡å¯ Docker æœåŠ¡

é…ç½®æ”¹äº†å¿…é¡»é‡å¯æ‰ç”Ÿæ•ˆï¼š

``` bash
sudo systemctl daemon-reload 
sudo systemctl restart docker
```

#### 4. å†æ¬¡å°è¯•æ„å»º

ç°åœ¨å†è·‘ä¸€æ¬¡ä½ çš„å‘½ä»¤ï¼š

``` bash
sudo docker build -t bio_app_v1 .
```

``` bash
 ---> Removed intermediate container ac2b0c5e832d
 ---> 9b607a8246da
Step 5/7 : COPY . .
 ---> 012e2d42a8ba
Step 6/7 : EXPOSE 8000
 ---> Running in 06b5a8b76cf9
 ---> Removed intermediate container 06b5a8b76cf9
 ---> 86f28df6cca2
Step 7/7 : CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
 ---> Running in 0c437b20f0b9
 ---> Removed intermediate container 0c437b20f0b9
 ---> 5a67c5dbe8ed
Successfully built 5a67c5dbe8ed
Successfully tagged bio_app_v1:latest
```

***æˆåŠŸäº†***

#### 2. è¿è¡Œï¼ˆRunï¼‰

è®©å®ƒåœ¨åå°é»˜é»˜è¿è¡Œï¼ˆ`-d`ï¼‰ï¼Œå¹¶ä¸”å“ªæ€•æœåŠ¡å™¨é‡å¯å®ƒä¹Ÿä¼šè‡ªåŠ¨å¤æ´»ï¼ˆ`--restart always`ï¼‰ã€‚ æˆ‘ä»¬è¦æŠŠ**æœåŠ¡å™¨çš„ 80 ç«¯å£**ï¼ˆç½‘é¡µé»˜è®¤ç«¯å£ï¼‰æ˜ å°„åˆ°**å®¹å™¨çš„ 8000 ç«¯å£**ã€‚

``` bash
sudo docker run -d \
  --name my_bio_container \
  --restart always \
  -p 80:8000 \
  bio_app_v1
```

``` bash
(base) jayz@WIN-92H1MBQ8SBB:/mnt/d/acode/datasql/script$ sudo docker run -d \
  --name my_bio_container \
  --restart always \
  -p 80:8000 \
  bio_app_v1
f5b3f854fc62f91b9f902e85d227ca5bd9ec027faea3e9906a8ae3d2a4a8d678
```

#### 3. æ£€æŸ¥çŠ¶æ€

``` bash
sudo docker ps
```

å¦‚æœçœ‹åˆ° `STATUS` æ˜¯ `Up ...`ï¼Œè¯´æ˜è¿è¡ŒæˆåŠŸï¼

``` bash
(base) jayz@WIN-92H1MBQ8SBB:/mnt/d/acode/datasql/script$ sudo docker ps
CONTAINER ID   IMAGE        COMMAND                  CREATED          STATUS          PORTS                                     NAMES
f5b3f854fc62   bio_app_v1   "uvicorn main:app --â€¦"   28 seconds ago   Up 27 seconds   0.0.0.0:80->8000/tcp, [::]:80->8000/tcp   my_bio_container
```

------------------------------------------------------------------------

### ğŸŒ Step 12: ç”¨æˆ·å¦‚ä½•ä½¿ç”¨ï¼Ÿï¼ˆæ¨¡æ‹ŸçœŸå®åœºæ™¯ï¼‰

å› ä¸ºä½ æ˜¯åœ¨ WSL é‡Œè·‘çš„ Dockerï¼Œå¹¶ä¸”æ˜ å°„åˆ°äº†å®¿ä¸»æœºï¼ˆWSLç¯å¢ƒï¼‰çš„ 80 ç«¯å£ï¼ŒWindows é€šå¸¸å¯ä»¥ç›´æ¥é€šè¿‡ localhost è®¿é—®ã€‚

è¯·æ‰“å¼€ä½ çš„ Chrome / Edge æµè§ˆå™¨ï¼Œè¾“å…¥ï¼š

#### 1. æŸ¥çœ‹è‡ªåŠ¨æ–‡æ¡£ï¼ˆSwagger UIï¼‰

è®¿é—®åœ°å€ï¼š\
ğŸ‘‰ [**http://localhost/docs**](https://www.google.com/url?sa=E&q=http%3A%2F%2Flocalhost%2Fdocs)

#### 2. å¦‚æœä½ æƒ³æ›´è¿›ä¸€æ­¥ï¼ˆç»™ä¸ªç®€æ˜“ç•Œé¢ï¼‰

ç”¨æˆ·è§‰å¾— JSON åªæœ‰ç¨‹åºèƒ½çœ‹æ‡‚ï¼Œæƒ³è¦ä¸ªç½‘é¡µã€‚ ä½ å¯ä»¥æé€Ÿå†™ä¸€ä¸ª `index.html` æ”¾åœ¨åŒä¸€ç›®å½•ä¸‹ï¼ˆç„¶åé‡æ–° build dockerï¼‰ï¼Œæˆ–è€…ç®€å•çš„æµ‹è¯•ä¸€ä¸‹ã€‚

ä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬åœ¨ `main.py` ç¨å¾®åŠ å‡ è¡Œï¼Œè®©å®ƒç›´æ¥è¿”å› HTMLï¼š

**(ä¿®æ”¹ main.py çš„æ ¹è·¯ç”±ä»£ç )**

``` python
from fastapi.responses import HTMLResponse # è®°å¾—å¯¼å…¥

@app.get("/", response_class=HTMLResponse)
def read_root():
    return """
    <html>
        <head>
            <title>Gene Search</title>
        </head>
        <body style="font-family: Arial; text-align: center; padding-top: 50px;">
            <h1>ğŸ§¬ åŸºå› ç»„æ•°æ®æŸ¥è¯¢ç³»ç»Ÿ</h1>
            <p>è¾“å…¥åŸºå› åç§°æŸ¥è¯¢å…¶åœ¨ä¸åŒæ ·æœ¬ä¸­çš„è¡¨è¾¾é‡</p>
            <input type="text" id="geneName" placeholder="ä¾‹å¦‚: TP53">
            <button onclick="search()">æŸ¥è¯¢</button>
            <pre id="result" style="text-align: left; background: #f0f0f0; padding: 20px; margin: 20px;"></pre>

            <script>
                async function search() {
                    let name = document.getElementById('geneName').value;
                    let response = await fetch('/get_gene?name=' + name);
                    let data = await response.json();
                    document.getElementById('result').textContent = JSON.stringify(data, null, 2);
                }
            </script>
        </body>
    </html>
    """
```

å¦‚æœä½ ä¿®æ”¹äº†ä»£ç ï¼Œè®°å¾—é‡æ–° build å’Œ runï¼š

``` bash
sudo docker stop my_bio_container
sudo docker rm my_bio_container
sudo docker build -t bio_app_v2 .
sudo docker run -d --name my_bio_container --restart always -p 80:8000 bio_app_v2
```

ç°åœ¨ï¼Œä½ çš„ç”¨æˆ·ç›´æ¥è®¿é—® [`http://æœåŠ¡å™¨IP`](http://æœåŠ¡å™¨IP)ï¼Œå°±ä¼šçœ‹åˆ°ä¸€ä¸ª**å¸¦æœ‰æœç´¢æ¡†çš„ç½‘é¡µ**ï¼è¾“å…¥åŸºå› åï¼Œç‚¹å‡»æŸ¥è¯¢ï¼Œç»“æœå°±æ˜¾ç¤ºåœ¨ä¸‹é¢ã€‚

------------------------------------------------------------------------

**ç›®å‰çš„çŠ¶å†µï¼š** å› ä¸ºä½ æ˜¯æŠŠ Docker è·‘åœ¨ä½ çš„ **ä¸ªäººç”µè„‘ (WSL)** é‡Œçš„ï¼Œæ‰€ä»¥ï¼š

1\. **ä½ è‡ªå·±**ï¼ˆè¿™å°ç”µè„‘ï¼‰ï¼šè‚¯å®šèƒ½è®¿é—® (`localhost`)ã€‚

2. **ä½ çš„åŒäº‹**ï¼ˆåŒä¸€é—´åŠå…¬å®¤ï¼Œè¿ç€åŒä¸€ä¸ª Wi-Fiï¼‰ï¼š**ç†è®ºä¸Š**å¯ä»¥é€šè¿‡è¾“å…¥ä½ çš„ç”µè„‘ IP è®¿é—®ï¼Œä½†ç»å¸¸ä¼šè¢« **Windows é˜²ç«å¢™** æˆ–è€… **WSL çš„ç½‘ç»œéš”ç¦»** æŒ¡ä½ï¼Œå¯¼è‡´è¿æ¥å¤±è´¥ã€‚

3\. **ä½ åœ¨åŒ—äº¬ï¼Œè€æ¿åœ¨ä¸Šæµ·**ï¼š**å®Œå…¨æ— æ³•è®¿é—®**ã€‚

æƒ³è¦åˆ«äººä¹Ÿèƒ½ç”¨ï¼Œæœ‰ **ä¸Šã€ä¸­ã€ä¸‹** ä¸‰ç­–ã€‚ çœ‹ä½ æƒ³è¾¾åˆ°ä»€ä¹ˆæ•ˆæœï¼š

------------------------------------------------------------------------

### ğŸ¥‰ ä¸‹ç­–ï¼šå±€åŸŸç½‘è®¿é—®ï¼ˆä»…é™åŒä¸€ Wi-Fi ä¸‹çš„åŒäº‹ï¼‰

å¦‚æœä½ åªæƒ³ç»™ååœ¨ä½ éš”å£æ¡Œçš„åŒäº‹ç§€ä¸€ä¸‹ã€‚

**1. æŸ¥ä½ çš„ç”µè„‘ IP** ä¸è¦åœ¨ WSL é‡ŒæŸ¥ï¼Œè¦åœ¨ **Windows çš„ PowerShell** é‡ŒæŸ¥ã€‚ æ‰“å¼€ PowerShellï¼Œè¾“å…¥ï¼š

``` powershell
ipconfig
```

æ‰¾åˆ° **â€œæ— çº¿å±€åŸŸç½‘é€‚é…å™¨ WLANâ€** æˆ–è€… **â€œä»¥å¤ªç½‘é€‚é…å™¨â€**ï¼ˆå–å†³äºä½ æ’ç½‘çº¿è¿˜æ˜¯è¿ WiFiï¼‰ã€‚ æ‰¾åˆ° `IPv4 åœ°å€`ï¼Œæ¯”å¦‚æ˜¯ `192.168.3.105`ã€‚

**2. åŒäº‹å°è¯•è®¿é—®** è®©ä½ åŒäº‹æ‰“å¼€æµè§ˆå™¨è¾“å…¥ï¼š[`http://192.168.3.105`](http://192.168.3.105)

-   **å¦‚æœæˆåŠŸ**ï¼šé‚£å¤ªå¥½äº†ï¼
-   **å¦‚æœå¤±è´¥**ï¼ˆè½¬åœˆåœˆï¼‰ï¼šè¿™æ˜¯å› ä¸º Windows çš„é˜²ç«å¢™æŠŠä½ ä¿æŠ¤èµ·æ¥äº†ã€‚ä½ éœ€è¦å»â€œé˜²ç«å¢™å’Œç½‘ç»œä¿æŠ¤â€é‡Œå…è®¸ 80 ç«¯å£ï¼Œè¿™å¯¹å°ç™½æ¥è¯´ç¨å¾®æœ‰ç‚¹ç¹çã€‚

------------------------------------------------------------------------

### ğŸ¥ˆ ä¸­ç­–ï¼šå†…ç½‘ç©¿é€ï¼ˆæ— éœ€ä¹°æœåŠ¡å™¨ï¼Œç»™å…¨ä¸–ç•Œå±•ç¤ºï¼ï¼‰ğŸ”¥ **æ¨è**

å¦‚æœæˆ‘æƒ³åœ¨é¢è¯•æ—¶ï¼Œç›´æ¥æå‡ºæ‰‹æœºå±•ç¤ºç»™é¢è¯•å®˜çœ‹ï¼Œæˆ–è€…å‘ç»™å¼‚åœ°çš„æœ‹å‹æµ‹è¯•ã€‚ ä½†æˆ‘ä¸æƒ³èŠ±é’±ä¹°äº‘æœåŠ¡å™¨ï¼Œæ€ä¹ˆåŠï¼Ÿ

æˆ‘ä»¬è¦ç”¨ **â€œå†…ç½‘ç©¿é€â€** å·¥å…·ï¼ˆMagic Tunnelï¼‰ã€‚å®ƒèƒ½ç»™ä½ ç”Ÿæˆä¸€ä¸ª**å…¬ç½‘é“¾æ¥**ï¼Œç›´æ¥è¿é€šä½ è¿™å°ç”µè„‘çš„ Dockerã€‚

å›½å†…æœ€å¥½ç”¨çš„æ˜¯ **cpolar** æˆ– **ngrok**ã€‚è¿™é‡Œä»¥ **cpolar** ä¸ºä¾‹ï¼ˆå…è´¹ï¼Œå›½å†…é€Ÿåº¦å¿«ï¼‰ï¼š

**1. åœ¨ä½ çš„ WSL é‡Œå®‰è£… cpolar**

``` bash
curl -L https://www.cpolar.com/static/downloads/install-release-cpolar.sh | sudo bash
```

**2. å¯åŠ¨ç©¿é€ï¼ˆæŠŠ 80 ç«¯å£æš´éœ²å‡ºå»ï¼‰**

``` bash
cpolar http 80
```

*(å¦‚æœæ²¡æœ‰è´¦å·ï¼Œå®ƒä¼šæç¤ºä½ å»å®˜ç½‘å…è´¹æ³¨å†Œä¸€ä¸ªï¼Œå¤åˆ¶ token ç²˜è´´ä¸€ä¸‹å°±è¡Œ)*

**3. è§è¯å¥‡è¿¹** cpolar ä¼šåç»™ä½ ä¸€ä¸ªç±»ä¼¼è¿™æ ·çš„ç½‘å€ï¼š [`http://42f9a1b.r10.cpolar.top`](http://42f9a1b.r10.cpolar.top)

**æŠŠè¿™ä¸ªé“¾æ¥å‘ç»™ä»»ä½•äººï¼ˆç”šè‡³å‘ç»™æˆ‘ï¼‰ï¼** åªè¦ä½ ç”µè„‘ä¸å…³ï¼ŒDocker ä¸åœï¼Œå…¨ä¸–ç•Œä»»ä½•æœ‰ç½‘çš„åœ°æ–¹ï¼Œéƒ½èƒ½é€šè¿‡è¿™ä¸ªé“¾æ¥æ‰“å¼€ä½ çš„åŸºå› æŸ¥è¯¢ç½‘ç«™ï¼

> **é¢è¯•ç»æ€**ï¼š é¢è¯•å®˜ï¼šâ€œä½ çš„é¡¹ç›®æœ‰çº¿ä¸Šåœ°å€å—ï¼Ÿâ€ ä½ ï¼šâ€œæœ‰çš„ï¼Œè¿™æ˜¯æ¼”ç¤ºç¯å¢ƒåœ°å€ã€‚â€ï¼ˆé€’è¿‡æ‰‹æœº/é“¾æ¥ï¼‰ *ï¼ˆé¢è¯•å®˜å†…å¿ƒ OSï¼šè¿™äººä¸æ˜¯åªæœ‰ç†è®ºï¼Œæ˜¯çœŸçš„åŠ¨æ‰‹åšå‡ºæ¥äº†ã€‚ï¼‰*

------------------------------------------------------------------------

### ğŸ¥‡ ä¸Šç­–ï¼šäº‘æœåŠ¡å™¨éƒ¨ç½²ï¼ˆçœŸæ­£çš„å…¬å¸çº§åšæ³•ï¼‰

å…¬å¸é‡Œè‚¯å®šä¸ä¼šç”¨â€œä¸ªäººç”µè„‘ + å†…ç½‘ç©¿é€â€æ¥æä¾›æœåŠ¡ï¼ˆä¸ç¨³å®šï¼Œç”µè„‘å…³æœºå°±å´©äº†ï¼‰ã€‚ å…¬å¸æ˜¯å» **é˜¿é‡Œäº‘ / è…¾è®¯äº‘ / AWS** ç§Ÿä¸€å° 24å°æ—¶å¼€æœºçš„äº‘æœåŠ¡å™¨ã€‚

**è¿™å°±å›åˆ°äº†æˆ‘ä»¬çš„ Docker ä¼˜åŠ¿äº†ï¼š** ä½ ç°åœ¨çš„é¡¹ç›®å·²ç» Docker åŒ–äº†ã€‚ä½ æƒ³æŠŠå®ƒæ¬åˆ°äº‘ä¸Šï¼Œåªéœ€è¦ï¼š

1.  **ç§ŸæœåŠ¡å™¨**ï¼šæ¯”å¦‚ä¹°ä¸€å°æœ€ä¾¿å®œçš„é˜¿é‡Œäº‘ ECSï¼ˆUbuntu ç³»ç»Ÿï¼‰ã€‚
2.  **è£… Docker**ï¼šåœ¨äº‘æœåŠ¡å™¨ä¸Šè¿è¡Œ `apt install docker.io`ã€‚
3.  **è·‘ä»£ç **ï¼š
    -   æŠŠä½ çš„ `Dockerfile` å’Œ `requirements.txt` ç­‰æ–‡ä»¶ä¸Šä¼ ä¸Šå»ã€‚
    -   æ‰§è¡Œä¸€æ¨¡ä¸€æ ·çš„æ„å»ºå‘½ä»¤ï¼š`docker build ...`
    -   æ‰§è¡Œä¸€æ¨¡ä¸€æ ·çš„è¿è¡Œå‘½ä»¤ï¼š`docker run ...`

**ç»“æœï¼š** ä½ ä¼šè·å¾—ä¸€ä¸ª **å›ºå®šçš„å…¬ç½‘ IP**ï¼ˆæ¯”å¦‚ `47.100.xx.xx`ï¼‰ã€‚ ä»¥åè¿™å°±æ˜¯ä½ ä»¬å…¬å¸çš„æ­£å¼æœåŠ¡åœ°å€ï¼Œç¨³å®šã€å®‰å…¨ã€‚

------------------------------------------------------------------------

### ğŸ’¡ æ€»ç»“å»ºè®®

-   **ç°åœ¨ä¸ºäº†ç»ƒä¹ å’Œå±•ç¤º**ï¼šç”¨ **ğŸ¥ˆ ä¸­ç­– (cpolar)**ã€‚æœ€å¿«ï¼Œé›¶æˆæœ¬ï¼Œé©¬ä¸Šèƒ½è£…æ¯ã€‚

-   **å¦‚æœä¸å·®é’±ï¼ˆæˆ–è€…æœ‰å­¦ç”Ÿä¼˜æƒ ï¼‰**ï¼šå»ä¹°ä¸ªå‡ åå—é’±ä¸€ä¸ªæœˆçš„è½»é‡çº§äº‘æœåŠ¡å™¨ï¼Œèµ° **ğŸ¥‡ ä¸Šç­–**ã€‚è¿™æ˜¯æœ€æ ‡å‡†çš„åšæ³•ã€‚

### 

**Streamlit** åœ¨ç”Ÿç‰©ä¿¡æ¯é¢†åŸŸï¼ˆä»¥åŠæ•°æ®ç§‘å­¦åœˆï¼‰ï¼Œå†™ HTML + JavaScript å¯¹æˆ‘ä»¬æ¥è¯´æœ‰ç‚¹â€œè¶…çº²â€ä¸”ä½æ•ˆã€‚**Streamlit** æ˜¯ç›®å‰å…¬è®¤çš„ **â€œä¸ç”¨å†™å‰ç«¯ä»£ç ï¼Œä¹Ÿèƒ½åšå‡ºç²¾ç¾ç½‘é¡µâ€** çš„ç¥å™¨ã€‚

å¦‚æœæ˜¯ç”¨ Streamlitï¼Œæˆ‘ä»¬çš„æ¶æ„å°±å˜æˆäº†æœ€ç»å…¸çš„ **â€œå‰åç«¯åˆ†ç¦»â€** æ¨¡å¼ï¼š

1.  **åç«¯ (FastAPI + Docker)**ï¼šè´Ÿè´£å¹²è‹¦åŠ›ï¼ŒæŸ¥åº“ã€ç®—æ•°æ®ï¼Œæä¾› JSON æ¥å£ã€‚ï¼ˆä½ åˆšåˆšå·²ç»åšå¥½äº†ï¼ï¼‰
2.  **å‰ç«¯ (Streamlit)**ï¼šè´Ÿè´£â€œè²Œç¾å¦‚èŠ±â€ï¼Œç”»å›¾ã€å±•ç¤ºè¡¨æ ¼ï¼Œ**å»è°ƒç”¨åç«¯çš„æ¥å£**ã€‚

------------------------------------------------------------------------

### ğŸ¨ å®æˆ˜ï¼šç”¨ Streamlit ç»™ä½ çš„ç”Ÿä¿¡æ•°æ®åº“æ¢ä¸ªâ€œçš®è‚¤â€

æˆ‘ä»¬è¦æŠŠä¹‹å‰ç®€é™‹çš„ HTML é¡µé¢æ‰”æ‰ï¼Œæ¢æˆä¸€ä¸ªé«˜å¤§ä¸Šçš„æ•°æ®é¢æ¿ã€‚

#### Step 1: å®‰è£… Streamlit

åœ¨ä½ çš„ WSL ç»ˆç«¯é‡Œæ‰§è¡Œï¼ˆæ­¤æ—¶æ˜¯åœ¨å®¹å™¨å¤–é¢çš„ç¯å¢ƒï¼‰ï¼š

``` bash
pip install streamlit requests pandas
```

#### Step 2: ç¼–å†™ Streamlit å‰ç«¯ä»£ç 

æ–°å»ºä¸€ä¸ªæ–‡ä»¶ `ui_app.py`ï¼š

``` python
import streamlit as st
import requests
import pandas as pd

# ğŸ¨ 1. é¡µé¢æ ‡é¢˜å’Œå¸ƒå±€
st.set_page_config(page_title="Omics åŸºå› æŸ¥è¯¢å¹³å°", page_icon="ğŸ§¬", layout="wide")

st.title("ğŸ§¬ å…¬å¸çº§åŸºå› è¡¨è¾¾é‡æŸ¥è¯¢ç³»ç»Ÿ")
st.markdown("---")

# ğŸ” 2. ä¾§è¾¹æ ï¼šæœç´¢åŒº
with st.sidebar:
    st.header("ğŸ” æŸ¥è¯¢æ¡ä»¶")
    gene_name = st.text_input("è¾“å…¥åŸºå› åç§° (Gene Symbol)", "TP53")
    
    # ä¸€ä¸ªå¤§å¤§çš„æœç´¢æŒ‰é’®
    search_btn = st.button("å¼€å§‹æ£€ç´¢", type="primary")

# ğŸš€ 3. ä¸»é€»è¾‘ï¼šç‚¹å‡»æŒ‰é’®åè§¦å‘
if search_btn:
    if not gene_name:
        st.warning("è¯·å…ˆè¾“å…¥åŸºå› åç§°ï¼")
    else:
        # æ˜¾ç¤ºåŠ è½½æ¡
        with st.spinner(f"æ­£åœ¨æ•°æ®åº“ä¸­æ£€ç´¢ {gene_name} ..."):
            try:
                # ============================================
                # å…³é”®ç‚¹ï¼šå‰ç«¯æ‰¾åç«¯æ‹¿æ•°æ® (Call API)
                # å‡è®¾ä½ çš„ FastAPI Docker æ­£è·‘åœ¨æœ¬åœ°çš„ 80 ç«¯å£
                # ============================================
                api_url = f"http://127.0.0.1:80/get_gene?name={gene_name}"
                response = requests.get(api_url)
                
                # å¤„ç†åç«¯è¿”å›çš„ JSON
                if response.status_code == 200:
                    result = response.json()
                    
                    if result.get("status") == "success":
                        st.success(f"æŸ¥è¯¢æˆåŠŸï¼å…±æ‰¾åˆ° {result['results_count']} æ¡è®°å½•")
                        
                        # --- æ•°æ®å±•ç¤ºåŒº ---
                        data_list = result['data']
                        
                        # A. æ˜¾ç¤ºåŸºå› åŸºæœ¬ä¿¡æ¯ (æ‹¿ç¬¬ä¸€æ¡æ•°æ®å±•ç¤ºå³å¯)
                        first_record = data_list[0]
                        col1, col2 = st.columns(2)
                        with col1:
                            st.info(f"**Gene ID:** {first_record['gene_id']}")
                        with col2:
                            st.info(f"**Description:** {first_record['description']}")
                            
                        # B. æ„é€ è¡¨æ ¼æ•°æ®
                        # æˆ‘ä»¬æŠŠåµŒå¥—çš„ JSON æ‹å¹³ï¼Œæ–¹ä¾¿ç”¨ DataFrame å±•ç¤º
                        table_rows = []
                        for item in data_list:
                            row = {
                                "æ ·æœ¬ID": item['sample_info']['id'],
                                "ç»„ç»‡ç±»å‹": item['sample_info']['tissue'],
                                "ç–¾ç—…çŠ¶æ€": item['sample_info']['condition'],
                                "è¡¨è¾¾é‡ (TPM)": item['expression_tpm']
                            }
                            table_rows.append(row)
                        
                        df = pd.read_json(pd.io.json.dumps(table_rows), orient='records') # ç®€å•çš„è½¬æ¢æ–¹å¼
                        # æˆ–è€…ç›´æ¥ df = pd.DataFrame(table_rows)

                        st.subheader(f"ğŸ“Š {result['query_gene']} è¡¨è¾¾é‡åˆ†å¸ƒè¡¨")
                        st.dataframe(df, use_container_width=True)
                        
                        # C. ç”»ä¸ªå›¾ (Streamlit çš„å¼ºé¡¹)
                        st.subheader("ğŸ“ˆ è¡¨è¾¾é‡å¯è§†åŒ–")
                        st.bar_chart(df.set_index("æ ·æœ¬ID")["è¡¨è¾¾é‡ (TPM)"])
                        
                    else:
                        st.error(f"âŒ {result.get('message')}")
                else:
                    st.error("ğŸ”Œ æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥ FastAPI æ˜¯å¦åœ¨è¿è¡Œã€‚")
                    
            except Exception as e:
                st.error(f"å‘ç”Ÿç³»ç»Ÿé”™è¯¯: {e}")

# é¡µè„š
st.markdown("---")
st.caption("Developed by BioInfo-DevOps Engineer | Tech Stack: FastAPI + Docker + Streamlit + PostgreSQL")
```

#### Step 3: è¿è¡Œ Streamlit

åœ¨ç»ˆç«¯é‡Œè¾“å…¥ï¼š

``` bash
streamlit run ui_app.py
```

ç»ˆç«¯ä¼šå¼¹å‡ºç±»ä¼¼è¿™æ ·çš„æç¤ºï¼š

```         
  You can now view your Streamlit app in your browser.
  Local URL: http://localhost:8501
```

#### Step 4: è§è¯æ—¶åˆ»

æ‰“å¼€æµè§ˆå™¨è®¿é—® [**`http://localhost:8501`**](http://localhost:8501)ã€‚

ä½ å°†çœ‹åˆ°ä¸€ä¸ªéå¸¸ä¸“ä¸šçš„ Dashboardï¼ \* å·¦è¾¹è¾“å…¥ `TP53` (æˆ–è€…ä½ ä¹‹å‰é€ æ•°æ®çš„åå­— `ABC12` ç­‰)ã€‚ \* ç‚¹å‡»æŸ¥è¯¢ã€‚ \* **ä½ å¯ä»¥ç›´æ¥çœ‹åˆ°è¡¨æ ¼ï¼Œè¿˜èƒ½ç›´æ¥çœ‹åˆ°æŸ±çŠ¶å›¾ï¼** ğŸ“Š

------------------------------------------------------------------------

### ğŸ§ é¢è¯•æ·±åº¦åˆ†æï¼šè¿™æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ

ä½ å¯èƒ½ä¼šé—®ï¼šâ€œJayzï¼Œè¿™å’Œæˆ‘ç›´æ¥ç”¨ Streamlit è¿æ•°æ®åº“æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿâ€

åŒºåˆ«å¤§äº†ï¼è¿™å°±æ˜¯ **è„šæœ¬å°å­** å’Œ **ç³»ç»Ÿæ¶æ„å¸ˆ** çš„åŒºåˆ«ã€‚

-   **è„šæœ¬åšæ³•**ï¼šStreamlit ç›´æ¥å†™ SQL è¿æ•°æ®åº“ã€‚
    -   *ç¼ºç‚¹*ï¼šä¸å®‰å…¨ï¼ˆå‰ç«¯ç›´æ¥æš´éœ²æ•°æ®åº“å¯†ç ï¼‰ï¼›å‰ç«¯å¦‚æœæŒ‚äº†ï¼Œæ•°æ®åº“è¿æ¥æ²¡æ–­å¯èƒ½å¯¼è‡´é”æ­»ï¼›å¾ˆéš¾å¼€å‘é…å¥—çš„æ‰‹æœº APPã€‚
-   **ä½ ç°åœ¨çš„åšæ³• (å¾®æœåŠ¡æ¶æ„)**ï¼š
    -   **Browser (Streamlit)** -\> **API (FastAPI)** -\> **DB (Postgres)**
    -   *ä¼˜ç‚¹*ï¼š
        1.  **è§£è€¦**ï¼šå¦‚æœæœ‰ä¸€å¤©è€æ¿è¯´è¦åšä¸ªå¾®ä¿¡å°ç¨‹åºï¼Œä½ çš„ FastAPI æ¥å£å®Œå…¨ä¸ç”¨åŠ¨ï¼Œç›´æ¥å¤ç”¨ã€‚Streamlit åªæ˜¯ UI çš®è‚¤ä¹‹ä¸€ã€‚
        2.  **å®‰å…¨**ï¼šStreamlit æ ¹æœ¬ä¸çŸ¥é“æ•°æ®åº“çš„å¯†ç ï¼Œå®ƒåªçŸ¥é“ API åœ°å€ã€‚
        3.  **æ‰©å±•æ€§**ï¼šåç«¯å¯ä»¥åŠ ç¼“å­˜ã€åŠ é™æµï¼Œå‰ç«¯æ— æ„Ÿã€‚

**è¯Šæ–­æŠ¥å‘Šï¼š** æŠ¥é”™é‡Œå†™ç€ï¼š`connection to server at "localhost" ... failed`ã€‚ è¿™è¯´æ˜ä½ çš„ Docker å®¹å™¨é‡Œçš„ä»£ç ï¼Œ**ä»ç„¶åœ¨è¯•å›¾è¿æ¥ "localhost"**ã€‚

### ğŸš¨ æ ¹æœ¬åŸå›  

åœ¨ Docker å®¹å™¨çš„**å†…éƒ¨ä¸–ç•Œ**é‡Œï¼Œ`localhost` æŒ‡çš„æ˜¯**å®¹å™¨è‡ªå·±**ã€‚ ä½ çš„ PostgreSQL æ•°æ®åº“å¹¶ä¸åœ¨å®¹å™¨é‡Œï¼Œè€Œæ˜¯åœ¨å¤–é¢çš„ Ubuntuï¼ˆå®¿ä¸»æœºï¼‰ä¸Šã€‚ å®¹å™¨å»æ‰¾è‡ªå·±ä½“å†…çš„ 5432 ç«¯å£ï¼Œå‘ç°ç©ºç©ºå¦‚ä¹Ÿï¼Œäºæ˜¯æŠ¥é”™ `Connection refused`ã€‚

**æˆ‘ä»¬ä¹‹å‰çš„ä¿®æ”¹æ²¡æœ‰ç”Ÿæ•ˆï¼Œæˆ–è€…ä½ å¿˜è®°ä¿®æ”¹ä»£ç å¹¶é‡æ–°æ‰“åŒ…é•œåƒäº†ã€‚**

------------------------------------------------------------------------

### ğŸ› ï¸ ä¿®å¤æ­¥éª¤ (åªéœ€ 2 åˆ†é’Ÿ)

æˆ‘ä»¬éœ€è¦åšä¸‰ä»¶äº‹ï¼šæ”¹ä»£ç ã€é‡æ‰“åŒ…ã€é‡è¿è¡Œã€‚

#### 1. ä¿®æ”¹ main.py ä»£ç 

å›åˆ°ä½ çš„é¡¹ç›®ç›®å½•ï¼Œç¼–è¾‘ `main.py`ã€‚

``` bash
nano main.py
```

æ‰¾åˆ°é…ç½®æ•°æ®åº“è¿æ¥çš„é‚£ä¸€è¡Œï¼ˆå¤§æ¦‚åœ¨ç¬¬ 10 è¡Œå·¦å³ï¼‰ï¼š **âŒ é”™è¯¯å†™æ³• (ç›®å‰çš„ä»£ç )**ï¼š

``` python
DB_URL = "postgresql+psycopg2://bio_admin:bio12345@localhost/omics_db"
```

**âœ… æ­£ç¡®å†™æ³• (æ”¹æˆ Docker ç½‘å…³ IP)**ï¼š *(æ³¨ï¼š172.17.0.1 æ˜¯ Linux/WSL ä¸‹ Docker å®¹å™¨è®¿é—®å®¿ä¸»æœºçš„é»˜è®¤ IP)*

``` python
DB_URL = "postgresql+psycopg2://bio_admin:bio12345@172.17.0.1/omics_db"
```

ä¿å­˜å¹¶é€€å‡º (`Ctrl+O` -\> `Enter` -\> `Ctrl+X`)ã€‚

------------------------------------------------------------------------

#### 2. åˆ é™¤æ—§å®¹å™¨å¹¶é‡æ–°æ„å»º (Rebuild)

ä»£ç æ”¹äº†ï¼Œ**å¿…é¡»é‡æ–°æ„å»ºé•œåƒ**ï¼Œå¦åˆ™ Docker è·‘çš„è¿˜æ˜¯æ—§ä»£ç ã€‚

``` bash
# 1. åœæ­¢å¹¶åˆ é™¤æ—§å®¹å™¨
sudo docker stop my_bio_container
sudo docker rm my_bio_container

# 2. é‡æ–°æ‰“åŒ… (è¿™æ—¶å€™ä¼šæŠŠä½ åˆšæ”¹çš„ main.py å°å°è¿›å»)
sudo docker build -t bio_app_v2 .
```

------------------------------------------------------------------------

#### 3. è¿è¡Œæ–°å®¹å™¨

``` bash
# 3. å¯åŠ¨æ–°ç‰ˆæœ¬çš„å®¹å™¨
sudo docker run -d \
  --name my_bio_container \
  --restart always \
  -p 80:8000 \
  bio_app_v2
```

------------------------------------------------------------------------

#### 4. å†æ¬¡éªŒè¯ Streamlit

ç°åœ¨ï¼Œå›åˆ°ä½ çš„ Streamlit é¡µé¢ï¼Œç›´æ¥ç‚¹å‡»é‚£ä¸ªâ€œå¼€å§‹æ£€ç´¢â€æŒ‰é’®ã€‚ (ä¸ç”¨é‡å¯ Streamlitï¼Œå› ä¸ºå®ƒåªæ˜¯å»è°ƒ 80 ç«¯å£ï¼Œåªè¦ 80 ç«¯å£é€šäº†å°±è¡Œ)ã€‚

ç°åœ¨çš„æƒ³æ³•æ˜¯èµ°å‘**Serverlessï¼ˆæ— æœåŠ¡å™¨ï¼‰æ¶æ„**ï¼Œè¿™æ˜¯ç°åœ¨æœ€æµè¡Œçš„çœé’±åˆé«˜æ•ˆçš„åšæ³•ã€‚

**ä½†æ˜¯ï¼ˆåˆ’é‡ç‚¹ï¼‰ï¼š** å¦‚æœä½ åªæŠŠä»£ç ä¸Šä¼ åˆ° GitHub å¹¶éƒ¨ç½²åˆ° Streamlit Cloudï¼Œå®ƒ**100% è·‘ä¸èµ·æ¥**ã€‚ **ä¸ºä»€ä¹ˆï¼Ÿ** å› ä¸º Streamlit Cloud çš„æœåŠ¡å™¨åœ¨äº‘ç«¯ï¼ˆç¾å›½ï¼‰ï¼Œè€Œä½ çš„ PostgreSQL æ•°æ®åº“è¿˜åœ¨ä½ è‡ªå·±çš„ **WSLï¼ˆæœ¬åœ°ç”µè„‘ï¼‰** é‡Œã€‚äº‘ç«¯çš„æœåŠ¡å™¨æ˜¯è¿ä¸ä¸Šä½ å®¿èˆ/å®¶é‡Œçš„å†…ç½‘ IP çš„ã€‚

------------------------------------------------------------------------

### ğŸš€ è§£å†³æ–¹æ¡ˆï¼šå…è´¹â€œäº‘åŸç”Ÿâ€æ¶æ„ï¼ˆGitHub + Streamlit Cloud + Cloud DBï¼‰

è¦å®ç°â€œåˆ«äººèƒ½è®¿é—®â€ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä½ çš„**æœ¬åœ°æ•°æ®åº“**ä¹Ÿæ¬åˆ°äº‘ç«¯ã€‚ åˆ«æ‹…å¿ƒï¼Œä¸éœ€è¦ä¹°æœåŠ¡å™¨ï¼ç°åœ¨æœ‰å…è´¹çš„ **äº‘ PostgreSQL**ã€‚

æˆ‘æ•™ä½ ä¸€å¥— **â€œå…¨å…è´¹ã€å…¨äº‘ç«¯ã€ä»»ä½•äººå¯è®¿é—®â€** çš„é¡¶çº§æ–¹æ¡ˆï¼š 1. **æ•°æ®åº“**ï¼šæ¬å®¶åˆ° **Neon**ï¼ˆæœ€ç«çš„ Serverless Postgresï¼Œå…è´¹ï¼‰ã€‚ 2. **ä»£ç **ï¼šä¸Šä¼  **GitHub**ã€‚ 3. **éƒ¨ç½²**ï¼šä½¿ç”¨ **Streamlit Community Cloud**ã€‚

**æ¥ï¼Œè·Ÿç€æˆ‘åšï¼Œ10åˆ†é’Ÿæå®šä¸Šçº¿ï¼**

------------------------------------------------------------------------

### â˜ï¸ Step 1: è·å–å…è´¹çš„äº‘æ•°æ®åº“ (Neon)

1.  æ‰“å¼€ [Neon.tech](https://neon.tech/)ï¼Œç”¨ Google æˆ– GitHub è´¦å·æ³¨å†Œã€‚
2.  ç‚¹å‡» **"New Project"**ã€‚
3.  å®ƒä¼šç¬é—´ç»™ä½ åˆ›å»ºä¸€ä¸ª PostgreSQLã€‚
4.  **ä¿å­˜è¿æ¥ä¸²**ï¼šé¡µé¢ä¼šæ˜¾ç¤ºç±»ä¼¼ [`postgres://neondb_owner:AbCdEf12@ep-icy-`](postgres://neondb_owner:AbCdEf12@ep-icy-)`... .neon.tech/neondb` çš„å­—ç¬¦ä¸²ã€‚
    -   å¤åˆ¶è¿™ä¸ªé“¾æ¥ï¼è¿™å°±æ˜¯ä½ æ–°çš„ `DB_URL`ã€‚
    -   ***`psql 'DB_URL = "postgresql://neondb_owner:npg_KracX4hO7jAf@ep-falling-bird-a4m0z2kx-pooler.us-east-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require"`***

------------------------------------------------------------------------

### ğŸ“¤ Step 2: ç»™äº‘æ•°æ®åº“â€œçŒâ€æ•°æ®

ä½ éœ€è¦æŠŠä¹‹å‰çš„å»ºè¡¨å’Œæ•°æ®ç”Ÿæˆè„šæœ¬ï¼Œåœ¨è¿™ä¸ªæ–°åº“é‡Œè·‘ä¸€éã€‚

1.  åœ¨ä½ çš„ WSL æœ¬åœ°é¡¹ç›®ä¸­ï¼Œæ‰“å¼€ä¹‹å‰é‚£ä¸ª **Step 5** çš„ `etl_simulation.py`ï¼ˆä»¥åŠ Step 3 çš„å»ºè¡¨é€»è¾‘ï¼Œå¦‚æœä¹‹å‰æ˜¯åˆ†å¼€å†™çš„ï¼‰ã€‚

![](images/å±å¹•æˆªå›¾_6-12-2025_15558_console.neon.tech.jpeg)

1.  **ä¿®æ”¹ DB_URL**ï¼š æŠŠè„šæœ¬é‡Œçš„ `DB_URL = "postgresql://..."` ä¸´æ—¶æ¢æˆåˆšæ‰ **Neon çš„é‚£ä¸ªé•¿é“¾æ¥**ã€‚
2.  **è¿è¡Œè„šæœ¬**ï¼š `bash     python3 etl_simulation.py`

### ğŸ”¹ ä¿®æ”¹è„šæœ¬

åœ¨ `etl_simulation.py` é‡Œæ‰¾åˆ°ç±»ä¼¼ï¼š

``` python
DB_URL = "postgresql://bio_admin:bio12345@localhost:5432/omics_db" 
```

æ”¹æˆï¼š

``` python
DB_URL = "postgresql://neondb_owner:npg_KracX4hO7jAf@ep-falling-bird-a4m0z2kx-pooler.us-east-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require" 
```

### ğŸ”¹ éªŒè¯æ•°æ®æ˜¯å¦æˆåŠŸå¯¼å…¥

ä½ å¯ä»¥ç”¨ `psql` æˆ– Python æ¥æ£€æŸ¥ï¼š

**æ–¹æ³• 1ï¼špsql**

``` bash
psql "postgresql://neondb_owner:npg_KracX4hO7jAf@ep-falling-bird-a4m0z2kx-pooler.us-east-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require" 
```

ç„¶ååœ¨ psql é‡Œæ‰§è¡Œï¼š

``` sql
SELECT COUNT(*) FROM genes; 
```

å¦‚æœè¿”å› `500`ï¼Œè¯´æ˜æ•°æ®å·²ç»çŒå…¥æˆåŠŸã€‚

1.  **ç»“æœ**ï¼šç°åœ¨ä½ çš„äº‘ç«¯ Neon æ•°æ®åº“é‡Œæœ‰äº† 500 ä¸ªåŸºå› çš„æ•°æ®äº†ï¼

``` sql
(base) jayz@WIN-92H1MBQ8SBB:/mnt/d/acode/datasql/script$ psql "postgresql://neondb_owner:npg_KracX4hO7jAf@ep-falling-bird-a4m0z2kx-pooler.us-east-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require"
psql (16.11 (Ubuntu 16.11-0ubuntu0.24.04.1), server 17.7 (178558d))
WARNING: psql major version 16, server major version 17.
         Some psql features might not work.
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, compression: off)
Type "help" for help.

neondb=> SELECT COUNT(*) FROM genes;
 count 
-------
   500
(1 row)
--æŸ¥è¯¢--
neondb=> 
neondb=> SELECT * FROM genes LIMIT 5;
neondb=> SELECT COUNT(*) FROM expression_data;
SELECT * FROM expression_data LIMIT 5;
 count 
-------
  1500
(1 row)

 id | sample_id  | gene_id  | tpm_value | sequencing_date 
----+------------+----------+-----------+-----------------
  1 | Sample_001 | ENSG8576 |   34.0523 | 2025-12-06
  2 | Sample_001 | ENSG2923 |   19.4487 | 2025-12-06
  3 | Sample_001 | ENSG925  |   67.8558 | 2025-12-06
  4 | Sample_001 | ENSG926  |   23.5048 | 2025-12-06
  5 | Sample_001 | ENSG7621 |   14.6079 | 2025-12-06
(5 rows)
 gene_id  | gene_symbol | chromosome |                 description                 |     created_at
----------+-------------+------------+---------------------------------------------+---------------------
 ENSG8576 | TDNA3       | chr17      | Growth factor activity and receptor binding | 2025-10-22 00:00:00
 ENSG2923 | FJE35       | chr7       | Integral component of plasma membrane       | 2025-07-12 00:00:00
 ENSG925  | NAF22       | chr20      | ATP binding and kinase activity             | 2025-05-23 00:00:00
 ENSG926  | CQT90       | chr10      | Immune response and inflammatory signaling  | 2025-02-06 00:00:00
 ENSG7621 | ZJUL82      | chr6       | Cell cycle checkpoint signaling             | 2025-02-12 00:00:00
(5 rows)
```

------------------------------------------------------------------------

### ğŸ™ Step 3: ä¿®æ”¹ä»£ç ä»¥é€‚åº” GitHub éƒ¨ç½²

Streamlit Cloud ä¸è¿è¡Œ Dockerï¼Œå®ƒæ˜¯ç›´æ¥è¿è¡Œä½ çš„ Python ä»£ç ã€‚æˆ‘ä»¬éœ€è¦å¾®è°ƒä¸€ä¸‹æ–‡ä»¶ç»“æ„ã€‚

**1. ä¿®æ”¹ `requirements.txt`** ç¡®ä¿é‡Œé¢åŒ…å«è¿™ä¸‰ä¸ªæ ¸å¿ƒï¼š

``` text
streamlit
pandas
psycopg2-binary
sqlalchemy
```

**2. ä¿®æ”¹ `ui_app.py` (æœ€é‡è¦çš„æ”¹åŠ¨)** ä¸èƒ½æŠŠæ•°æ®åº“å¯†ç ç›´æ¥å†™åœ¨ä»£ç é‡Œä¸Šä¼ åˆ° GitHubï¼Œé‚£æ ·ä¼šè¢«é»‘å®¢æ‰«åˆ°ã€‚æˆ‘ä»¬è¦ç”¨ **Streamlit Secrets**ã€‚

ä¿®æ”¹ `ui_app.py` ä¸­çš„è¿æ¥éƒ¨åˆ†ï¼Œä¸å†è°ƒç”¨ APIï¼Œè€Œæ˜¯**ç›´æ¥è®© Streamlit è¿æ•°æ®åº“**ï¼ˆè¿™æ˜¯ Streamlit Cloud æœ€ç®€å•çš„éƒ¨ç½²æ–¹å¼ï¼Œä¸éœ€è¦ FastApi ä¸­è½¬äº†ï¼Œå› ä¸º Streamlit æœ¬èº«å°±æ˜¯åç«¯ï¼‰ï¼š

**æ–°å»º/é‡å†™ `app.py` (åˆå¹¶å‰åç«¯ï¼Œæ–¹ä¾¿éƒ¨ç½²)ï¼š**

``` python
import streamlit as st
import pandas as pd
from sqlalchemy import create_engine, text

# 1. é¡µé¢é…ç½®
st.set_page_config(page_title="åŸºå› äº‘æŸ¥è¯¢", page_icon="ğŸ§¬")
st.title("ğŸ§¬ äº‘ç«¯åŸºå› è¡¨è¾¾é‡æ•°æ®åº“")

# 2. è¿æ¥æ•°æ®åº“ (ä½¿ç”¨ st.secrets è¯»å–å¯†ç ï¼Œå®‰å…¨ï¼)
# è¿™é‡Œçš„ "db_url" æˆ‘ä»¬ç­‰ä¼šåœ¨ Streamlit ç½‘é¡µåå°é…ç½®
def get_connection():
    try:
        db_url = st.secrets["db_url"]
        engine = create_engine(db_url)
        return engine
    except Exception as e:
        st.error(f"æ•°æ®åº“è¿æ¥é…ç½®ç¼ºå¤±: {e}")
        return None

engine = get_connection()

# 3. æœç´¢ç•Œé¢
gene_name = st.text_input("è¾“å…¥åŸºå› å (ä¾‹å¦‚: TP53)", "TP53")
btn = st.button("æŸ¥è¯¢")

if btn and engine:
    with st.spinner("äº‘ç«¯æ£€ç´¢ä¸­..."):
        # ç›´æ¥å†™ SQL æŸ¥è¯¢ï¼Œä¸å»è°ƒ FastAPI äº†ï¼Œè¿™æ ·æœ€ç®€å•
        sql = text("""
            SELECT 
                g.gene_symbol, g.description, e.tpm_value, 
                s.tissue_type, s.condition
            FROM genes g
            JOIN expression_data e ON g.gene_id = e.gene_id
            JOIN sample_info s ON e.sample_id = s.sample_id
            WHERE g.gene_symbol LIKE :name
            LIMIT 50
        """)
        
        try:
            with engine.connect() as conn:
                df = pd.read_sql(sql, conn, params={"name": f"%{gene_name.upper()}%"})
            
            if not df.empty:
                st.success(f"æ‰¾åˆ° {len(df)} æ¡è®°å½•")
                st.dataframe(df)
                st.bar_chart(df.set_index("tissue_type")["tpm_value"])
            else:
                st.warning("æœªæ‰¾åˆ°ç›¸å…³åŸºå› æ•°æ®")
                
        except Exception as e:
            st.error(f"æŸ¥è¯¢å‡ºé”™: {e}")

st.markdown("---")
st.caption("Deploy on Streamlit Cloud | Database by Neon Serverless Postgres")
```

------------------------------------------------------------------------

### ğŸ± Step 4: ä¸Šä¼ åˆ° GitHub

1.  åœ¨ GitHub ä¸Šæ–°å»ºä¸€ä¸ªä»“åº“ï¼ˆRepositoryï¼‰ï¼Œæ¯”å¦‚å« `gene-app`ã€‚
2.  æŠŠä½ çš„æœ¬åœ°ä»£ç æ¨ä¸Šå»ï¼š `bash     git init     git add app.py requirements.txt     git commit -m "Initial commit"     git branch -M main     # æ¢æˆä½ çš„ä»“åº“åœ°å€     git remote add origin https://github.com/ä½ çš„ç”¨æˆ·å/gene-app.git     git push -u origin main`

------------------------------------------------------------------------

### ğŸŒ Step 5: åœ¨ Streamlit Cloud ä¸Šçº¿

è¿™æ˜¯æœ€åä¸€æ­¥ï¼

1.  è®¿é—® [share.streamlit.io](https://share.streamlit.io/) (ç”¨ GitHub ç™»å½•)ã€‚
2.  ç‚¹å‡» **"New app"**ã€‚
3.  **é€‰æ‹©ä»“åº“**ï¼šé€‰ä½ åˆšæ‰ä¼ çš„ `gene-app`ã€‚
4.  **Main file path**: å¡« `app.py`ã€‚
5.  ğŸ’¥ **å…³é”®æ­¥éª¤ï¼šé…ç½® Secrets (å¯†ç )**
    -   ç‚¹å‡»ä¸‹æ–¹çš„ **"Advanced settings..."**
    -   è¿™ä¸ªæ¡†æ¡†å°±åƒæ˜¯ä½ çš„ `.env` æ–‡ä»¶ã€‚å¡«å…¥ï¼š `toml     db_url = "postgres://neondb_owner:ä½ çš„å¯†ç @....neon.tech/neondb"`
    -   (æŠŠä½ åœ¨ Neon å¤åˆ¶çš„é‚£ä¸ªé•¿é“¾æ¥å¡«åœ¨è¿™é‡Œï¼Œè¿™å°±é¿å…äº†å¯†ç æ³„éœ²)
6.  ç‚¹å‡» **"Deploy"**ã€‚

------------------------------------------------------------------------

### ğŸ‰ è§è¯å¥‡è¿¹

Streamlit ä¼šè‡ªåŠ¨å®‰è£… `requirements.txt` é‡Œçš„åŒ…ï¼Œç„¶åå¯åŠ¨åº”ç”¨ã€‚ ä¸€ä¸¤åˆ†é’Ÿåï¼Œä½ ä¼šè·å¾—ä¸€ä¸ªé“¾æ¥ï¼Œç±»ä¼¼ï¼š [`https://gene-app-jayz.streamlit.app`](https://gene-app-jayz.streamlit.app)

**ä½ å¯ä»¥æŠŠè¿™ä¸ªé“¾æ¥å‘ç»™å…¨ä¸–ç•Œçš„ä»»ä½•äººï¼** ä¸ç®¡ä»–åœ¨ç¾å›½è¿˜æ˜¯ä¸­å›½ï¼Œä¸ç®¡æ˜¯æ‰‹æœºè¿˜æ˜¯ç”µè„‘ï¼Œæ‰“å¼€å°±èƒ½æŸ¥ä½ åˆšåˆšçŒå…¥äº‘ç«¯æ•°æ®åº“çš„æ•°æ®ã€‚

<https://databasegene-o3uuajzntlhczhc9mpa9jm.streamlit.app/>

![](images/å±å¹•æˆªå›¾_6-12-2025_12658_console.neon.tech-2.jpeg)

------------------------------------------------------------------------

### ğŸ’¡ ä¸ºä»€ä¹ˆæˆ‘æ¨èè¿™ä¸ªæ–¹æ¡ˆï¼Ÿ

è¿™ä¸ªæ–¹æ¡ˆæ¯”ä¹‹å‰é‚£ä¸ªâ€œDocker éƒ¨ç½²åˆ°æœåŠ¡å™¨â€çš„æ–¹æ¡ˆå…¶å®**æ›´é«˜çº§**ï¼Œå› ä¸ºå®ƒå®Œå…¨ç¬¦åˆç°ä»£äº’è”ç½‘çš„ **â€œå­˜ç®—åˆ†ç¦»â€** æ¶æ„ï¼š \* **è®¡ç®— (Compute)**: Streamlit Cloud (å…è´¹æ‰˜ç®¡ä»£ç ) \* **å­˜å‚¨ (Storage)**: Neon Postgres (å…è´¹æ‰˜ç®¡æ•°æ®) \* **è¿ç»´ (Ops)**: 0 è¿ç»´ï¼Œä¸ç”¨ç®¡ Linux é˜²ç«å¢™ã€ä¸ç”¨ç®¡ Docker æŒ‚æ²¡æŒ‚ã€‚